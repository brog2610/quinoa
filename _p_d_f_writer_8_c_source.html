<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Quinoa: /home/travis/build/jbakosi/quinoa/src/IO/PDFWriter.C Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Quinoa
   
   </div>
   <div id="projectbrief">Adaptive computational fluid dynamics</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Documents</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_p_d_f_writer_8_c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/home/travis/build/jbakosi/quinoa/src/IO/PDFWriter.C</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_p_d_f_writer_8_c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//******************************************************************************</span><span class="comment"></span>
<a name="l00002"></a>00002 <span class="comment">/*!</span>
<a name="l00003"></a>00003 <span class="comment">  \file      src/IO/PDFWriter.C</span>
<a name="l00004"></a>00004 <span class="comment">  \author    J. Bakosi</span>
<a name="l00005"></a>00005 <span class="comment">  \date      Mon 01 Jun 2015 02:25:27 PM MDT</span>
<a name="l00006"></a>00006 <span class="comment">  \copyright 2012-2015, Jozsef Bakosi.</span>
<a name="l00007"></a>00007 <span class="comment">  \brief     Univariate PDF writer</span>
<a name="l00008"></a>00008 <span class="comment">  \brief     PDF writer class definition</span>
<a name="l00009"></a>00009 <span class="comment">  \details   This file defines a PDF writer class that facilitates outputing</span>
<a name="l00010"></a>00010 <span class="comment">    probability density functions (PDFs) into files in various formats using</span>
<a name="l00011"></a>00011 <span class="comment">    various configurations.</span>
<a name="l00012"></a>00012 <span class="comment">*/</span>
<a name="l00013"></a>00013 <span class="comment">//******************************************************************************</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;exodusII.h&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;ne_nemesisI.h&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_p_d_f_writer_8h.html" title="PDF writer class declaration.">PDFWriter.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="_exception_8h.html" title="Exception class declaration.">Exception.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;Config.h&quot;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">using</span> <a class="code" href="classtk_1_1_p_d_f_writer.html" title="PDFWriter : Writer.">tk::PDFWriter</a>;
<a name="l00025"></a>00025 
<a name="l00026"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#ad866a267ce43916618205da175312bba">00026</a> PDFWriter::PDFWriter( <span class="keyword">const</span> std::string&amp; filename,
<a name="l00027"></a>00027                       <a class="code" href="namespacetk_1_1ctr.html#a270ba0ac9d911f0e874828015f82a28b">ctr::TxtFloatFormatType</a> format,
<a name="l00028"></a>00028                       kw::precision::info::expect::type precision ) :
<a name="l00029"></a>00029   <a class="code" href="classtk_1_1_writer.html">Writer</a>( filename )
<a name="l00030"></a>00030 <span class="comment">//******************************************************************************</span>
<a name="l00031"></a>00031 <span class="comment">//  Constructor</span><span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">//! \param[in] filename Output filename to which output the PDF</span>
<a name="l00033"></a>00033 <span class="comment">//! \param[in] format Configure floating-point output format for ASCII output</span>
<a name="l00034"></a>00034 <span class="comment">//! \param[in] precision Configure precision for floating-point ASCII output</span>
<a name="l00035"></a>00035 <span class="comment">//! \author J. Bakosi</span>
<a name="l00036"></a>00036 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00037"></a>00037 {
<a name="l00038"></a>00038   <span class="comment">// Set floating-point format for output file stream</span>
<a name="l00039"></a>00039   <span class="keywordflow">if</span> (format == <a class="code" href="namespacetk_1_1ctr.html#a270ba0ac9d911f0e874828015f82a28ba0354933e3876c5e0de4a8b92969c9cff">ctr::TxtFloatFormatType::DEFAULT</a>)
<a name="l00040"></a>00040     {} <span class="comment">//m_outFile &lt;&lt; std::defaultfloat;   GCC does not yet support this</span>
<a name="l00041"></a>00041   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code" href="namespacetk_1_1ctr.html#a270ba0ac9d911f0e874828015f82a28ba244fda2b97545dea7ea0031bf2efb356">ctr::TxtFloatFormatType::FIXED</a>)
<a name="l00042"></a>00042     <a class="code" href="classtk_1_1_writer.html#ae96bd6d4e680c490f290264a37cd1213" title="File output stream.">m_outFile</a> &lt;&lt; std::fixed;
<a name="l00043"></a>00043   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <a class="code" href="namespacetk_1_1ctr.html#a270ba0ac9d911f0e874828015f82a28ba51e7a2ea3bc2ac22159a3960884dfb17">ctr::TxtFloatFormatType::SCIENTIFIC</a>)
<a name="l00044"></a>00044     <a class="code" href="classtk_1_1_writer.html#ae96bd6d4e680c490f290264a37cd1213" title="File output stream.">m_outFile</a> &lt;&lt; std::scientific;
<a name="l00045"></a>00045   <span class="keywordflow">else</span> <a class="code" href="_exception_8h.html#a0412f798470c18f503a2c2f63c970ba8" title="Throw macro that always throws an exception.">Throw</a>( <span class="stringliteral">&quot;Text floating-point format not recognized.&quot;</span> );
<a name="l00046"></a>00046 
<a name="l00047"></a>00047   <span class="comment">// Set numeric precision for output file stream if the input makes sense</span>
<a name="l00048"></a>00048   <span class="keywordflow">if</span> (precision &gt; 0 &amp;&amp; precision &lt; std::numeric_limits&lt; tk::real &gt;::digits10+2)
<a name="l00049"></a>00049     m_outFile &lt;&lt; std::setprecision( static_cast&lt;int&gt;(precision) );
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="keywordtype">void</span>
<a name="l00053"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a1f798f74e0d815b8bc9e409fbc7da85c">00053</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a1f798f74e0d815b8bc9e409fbc7da85c" title="Write univariate PDF to text file.">PDFWriter::writeTxt</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_uni_p_d_f.html" title="Univariate PDF estimator.">UniPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, <span class="keyword">const</span> <a class="code" href="structtk_1_1ctr_1_1_p_d_f_info.html" title="PDF information bundle.">tk::ctr::PDFInfo</a>&amp; info ) <span class="keyword">const</span>
<a name="l00054"></a>00054 <span class="comment">//******************************************************************************</span>
<a name="l00055"></a>00055 <span class="comment">//  Write out standardized univariate PDF to file</span><span class="comment"></span>
<a name="l00056"></a>00056 <span class="comment">//! \param[in] pdf Univariate PDF</span>
<a name="l00057"></a>00057 <span class="comment">//! \param[in] info PDF metadata</span>
<a name="l00058"></a>00058 <span class="comment">//! \author J. Bakosi</span>
<a name="l00059"></a>00059 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; name = info.name;
<a name="l00062"></a>00062   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; uext = info.exts;
<a name="l00063"></a>00063   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> = info.vars;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065   assertSampleSpaceDimensions&lt; 1 &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> );
<a name="l00066"></a>00066   assertSampleSpaceExtents&lt; 1 &gt;( uext );
<a name="l00067"></a>00067 
<a name="l00068"></a>00068   <span class="comment">// Query and optionally override number of bins and minimum of sample space if</span>
<a name="l00069"></a>00069   <span class="comment">// user-specified extents were given and copy probabilities from pdf to an</span>
<a name="l00070"></a>00070   <span class="comment">// array for output</span>
<a name="l00071"></a>00071   std::size_t nbi;
<a name="l00072"></a>00072   tk::real min, max;
<a name="l00073"></a>00073   std::vector&lt; tk::real &gt; outpdf;
<a name="l00074"></a>00074   tk::real binsize;
<a name="l00075"></a>00075   std::array&lt; long, 2*UniPDF::dim &gt; ext;
<a name="l00076"></a>00076   extents( <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, uext, nbi, min, max, binsize, ext, outpdf );
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   <span class="comment">// Output header</span>
<a name="l00079"></a>00079   m_outFile &lt;&lt; <span class="stringliteral">&quot;# vim: filetype=sh:\n#\n&quot;</span>
<a name="l00080"></a>00080             &lt;&lt; <span class="stringliteral">&quot;# Univariate PDF: &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="charliteral">&#39;)&#39;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00081"></a>00081             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00082"></a>00082             &lt;&lt; <span class="stringliteral">&quot;# Numeric precision: &quot;</span> &lt;&lt; m_outFile.precision() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00083"></a>00083             &lt;&lt; <span class="stringliteral">&quot;# Bin size: &quot;</span> &lt;&lt; binsize &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00084"></a>00084             &lt;&lt; <span class="stringliteral">&quot;# Number of bins estimated: &quot;</span> &lt;&lt; ext[1] - ext[0] + 1
<a name="l00085"></a>00085             &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00086"></a>00086             &lt;&lt; <span class="stringliteral">&quot;# Number of bins output: &quot;</span> &lt;&lt; nbi &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00087"></a>00087             &lt;&lt; <span class="stringliteral">&quot;# Sample space extent: [&quot;</span> &lt;&lt; min &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; max &lt;&lt; <span class="stringliteral">&quot;]\n#\n&quot;</span>
<a name="l00088"></a>00088             &lt;&lt; <span class="stringliteral">&quot;# Example step-by-step visualization with gnuplot\n&quot;</span>
<a name="l00089"></a>00089             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00090"></a>00090             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set grid\n&quot;</span>
<a name="l00091"></a>00091             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; unset key\n&quot;</span>
<a name="l00092"></a>00092             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set xlabel \&quot;&quot;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>
<a name="l00093"></a>00093             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set ylabel \&quot;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="stringliteral">&quot;)\&quot;\n&quot;</span>
<a name="l00094"></a>00094             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; plot &quot;</span>;
<a name="l00095"></a>00095   <span class="keywordflow">if</span> (!uext.empty()) m_outFile &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; uext[0] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[1] &lt;&lt; <span class="stringliteral">&quot;] &quot;</span>;
<a name="l00096"></a>00096   m_outFile &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; m_filename &lt;&lt; <span class="stringliteral">&quot;\&quot; with points\n#\n&quot;</span>
<a name="l00097"></a>00097             &lt;&lt; <span class="stringliteral">&quot;# Gnuplot one-liner for quick copy-paste\n&quot;</span>
<a name="l00098"></a>00098             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00099"></a>00099             &lt;&lt; <span class="stringliteral">&quot;# set grid; unset key; set xlabel \&quot;&quot;</span> &lt;&lt; vars[0]
<a name="l00100"></a>00100             &lt;&lt; <span class="stringliteral">&quot;\&quot;; set ylabel \&quot;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; vars[0]
<a name="l00101"></a>00101             &lt;&lt; <span class="stringliteral">&quot;)\&quot;; plot&quot;</span>;
<a name="l00102"></a>00102   <span class="keywordflow">if</span> (!uext.empty()) m_outFile &lt;&lt; <span class="stringliteral">&quot; [&quot;</span> &lt;&lt; uext[0] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[1] &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;
<a name="l00103"></a>00103   m_outFile &lt;&lt; <span class="stringliteral">&quot; \&quot;&quot;</span> &lt;&lt; m_filename &lt;&lt; <span class="stringliteral">&quot;\&quot; w p\n#\n&quot;</span>
<a name="l00104"></a>00104             &lt;&lt; <span class="stringliteral">&quot;# Data columns: &quot;</span> &lt;&lt; vars[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; vars[0]
<a name="l00105"></a>00105             &lt;&lt; <span class="stringliteral">&quot;)\n# -----------------------------------------------\n&quot;</span>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="comment">// If no user-specified sample space extents, output pdf map directly</span>
<a name="l00108"></a>00108   <span class="keywordflow">if</span> (uext.empty()) {
<a name="l00109"></a>00109     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map())
<a name="l00110"></a>00110       m_outFile &lt;&lt; binsize * static_cast&lt;tk::real&gt;(p.first) &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00111"></a>00111                 &lt;&lt; <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(p.second) / binsize /
<a name="l00112"></a>00112                    static_cast&lt;tk::real&gt;(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample())
<a name="l00113"></a>00113                 &lt;&lt; std::endl;
<a name="l00114"></a>00114   } <span class="keywordflow">else</span> { <span class="comment">// If user-specified sample space extents, output outpdf array</span>
<a name="l00115"></a>00115     std::size_t bin = 0;
<a name="l00116"></a>00116     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : outpdf)
<a name="l00117"></a>00117       m_outFile &lt;&lt; binsize * static_cast&lt;tk::real&gt;(bin++) + uext[0] &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00118"></a>00118                 &lt;&lt; p &lt;&lt; std::endl;
<a name="l00119"></a>00119   }
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="keywordtype">void</span>
<a name="l00123"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a030e93d822be2adcfd0f43ee46505cbd">00123</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a1f798f74e0d815b8bc9e409fbc7da85c" title="Write univariate PDF to text file.">PDFWriter::writeTxt</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_bi_p_d_f.html" title="Joint bivariate PDF estimator.">BiPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, <span class="keyword">const</span> <a class="code" href="structtk_1_1ctr_1_1_p_d_f_info.html" title="PDF information bundle.">tk::ctr::PDFInfo</a>&amp; info ) <span class="keyword">const</span>
<a name="l00124"></a>00124 <span class="comment">//******************************************************************************</span>
<a name="l00125"></a>00125 <span class="comment">//  Write out standardized bivariate PDF to text file</span><span class="comment"></span>
<a name="l00126"></a>00126 <span class="comment">//! \param[in] pdf Bivariate PDF</span>
<a name="l00127"></a>00127 <span class="comment">//! \param[in] info PDF metadata</span>
<a name="l00128"></a>00128 <span class="comment">//! \author J. Bakosi</span>
<a name="l00129"></a>00129 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; name = info.name;
<a name="l00132"></a>00132   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; uext = info.exts;
<a name="l00133"></a>00133   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> = info.vars;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135   assertSampleSpaceDimensions&lt; 2 &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> );
<a name="l00136"></a>00136   assertSampleSpaceExtents&lt; 2 &gt;( uext );
<a name="l00137"></a>00137 
<a name="l00138"></a>00138   <span class="comment">// Query and optionally override number of bins and minima of sample space if</span>
<a name="l00139"></a>00139   <span class="comment">// user-specified extents were given and copy probabilities from pdf to a</span>
<a name="l00140"></a>00140   <span class="comment">// logically 2D array for output</span>
<a name="l00141"></a>00141   std::size_t nbix, nbiy;
<a name="l00142"></a>00142   tk::real xmin, xmax, ymin, ymax;
<a name="l00143"></a>00143   std::vector&lt; tk::real &gt; outpdf;
<a name="l00144"></a>00144   std::array&lt; tk::real, 2 &gt; binsize;
<a name="l00145"></a>00145   std::array&lt; long, 2*BiPDF::dim &gt; ext;
<a name="l00146"></a>00146   extents( <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, uext, nbix, nbiy, xmin, xmax, ymin, ymax, binsize, ext, outpdf,
<a name="l00147"></a>00147            <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15a8184d7d989393ae3d20f936f08dff89b">ctr::PDFCenteringType::ELEM</a> );
<a name="l00148"></a>00148 
<a name="l00149"></a>00149   <span class="comment">// Output metadata</span>
<a name="l00150"></a>00150   m_outFile &lt;&lt; <span class="stringliteral">&quot;# vim: filetype=sh:\n#\n&quot;</span>
<a name="l00151"></a>00151             &lt;&lt; <span class="stringliteral">&quot;# Joint bivariate PDF: &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span>
<a name="l00152"></a>00152             &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>
<a name="l00153"></a>00153             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00154"></a>00154             &lt;&lt; <span class="stringliteral">&quot;# Numeric precision: &quot;</span> &lt;&lt; m_outFile.precision() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00155"></a>00155             &lt;&lt; <span class="stringliteral">&quot;# Bin sizes: &quot;</span> &lt;&lt; binsize[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; binsize[1] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00156"></a>00156             &lt;&lt; <span class="stringliteral">&quot;# Number of bins estimated: &quot;</span> &lt;&lt; ext[1] - ext[0] + 1 &lt;&lt; <span class="stringliteral">&quot; x &quot;</span>
<a name="l00157"></a>00157             &lt;&lt; ext[3] - ext[2] + 1 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00158"></a>00158             &lt;&lt; <span class="stringliteral">&quot;# Number of bins output: &quot;</span> &lt;&lt; nbix &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; nbiy &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00159"></a>00159             &lt;&lt; <span class="stringliteral">&quot;# Sample space extents: [&quot;</span> &lt;&lt; xmin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; xmax
<a name="l00160"></a>00160             &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span> &lt;&lt; ymin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; ymax &lt;&lt; <span class="stringliteral">&quot;]\n#\n&quot;</span>
<a name="l00161"></a>00161             &lt;&lt; <span class="stringliteral">&quot;# Example step-by-step visualization with gnuplot\n&quot;</span>
<a name="l00162"></a>00162             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00163"></a>00163             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set grid\n&quot;</span>
<a name="l00164"></a>00164             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; unset key\n&quot;</span>
<a name="l00165"></a>00165             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set xlabel \&quot;&quot;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>
<a name="l00166"></a>00166             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set ylabel \&quot;&quot;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>
<a name="l00167"></a>00167             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set zlabel \&quot;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span>
<a name="l00168"></a>00168             &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] &lt;&lt; <span class="stringliteral">&quot;)\&quot;\n&quot;</span>
<a name="l00169"></a>00169             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set dgrid3d 50,50,1\n&quot;</span>
<a name="l00170"></a>00170             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set cntrparam levels 20\n&quot;</span>
<a name="l00171"></a>00171             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set contour\n&quot;</span>;
<a name="l00172"></a>00172   <span class="keywordflow">if</span> (!uext.empty())
<a name="l00173"></a>00173     m_outFile &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set xrange [&quot;</span> &lt;&lt; uext[0] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[1] &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00174"></a>00174               &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set yrange [&quot;</span> &lt;&lt; uext[2] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[3] &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;
<a name="l00175"></a>00175          
<a name="l00176"></a>00176   m_outFile &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; splot \&quot;&quot;</span> &lt;&lt; m_filename &lt;&lt; <span class="stringliteral">&quot;\&quot; with lines\n#\n&quot;</span>
<a name="l00177"></a>00177             &lt;&lt; <span class="stringliteral">&quot;# Gnuplot one-liner for quick copy-paste\n&quot;</span>
<a name="l00178"></a>00178             &lt;&lt; <span class="stringliteral">&quot;# --------------------------------------\n&quot;</span>
<a name="l00179"></a>00179             &lt;&lt; <span class="stringliteral">&quot;# set grid; unset key; set xlabel \&quot;&quot;</span> &lt;&lt; vars[0]
<a name="l00180"></a>00180             &lt;&lt; <span class="stringliteral">&quot;\&quot;; set ylabel \&quot;&quot;</span> &lt;&lt; vars[1] &lt;&lt; <span class="stringliteral">&quot;\&quot;; set zlabel \&quot;&quot;</span> &lt;&lt; name
<a name="l00181"></a>00181             &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; vars[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; vars[1] &lt;&lt; <span class="stringliteral">&quot;)\&quot;; set dgrid3d 50,50,1; &quot;</span>
<a name="l00182"></a>00182                <span class="stringliteral">&quot;set cntrparam levels 20; set contour; &quot;</span>;
<a name="l00183"></a>00183   <span class="keywordflow">if</span> (!uext.empty())
<a name="l00184"></a>00184     m_outFile &lt;&lt; <span class="stringliteral">&quot;set xrange [&quot;</span> &lt;&lt; uext[0] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[1] &lt;&lt; <span class="stringliteral">&quot;]; set yrange &quot;</span>
<a name="l00185"></a>00185                  <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; uext[2] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[3] &lt;&lt; <span class="stringliteral">&quot;]; &quot;</span>;
<a name="l00186"></a>00186   m_outFile &lt;&lt; <span class="stringliteral">&quot;splot \&quot;&quot;</span> &lt;&lt; m_filename &lt;&lt; <span class="stringliteral">&quot;\&quot; w l\n#\n&quot;</span>
<a name="l00187"></a>00187             &lt;&lt; <span class="stringliteral">&quot;# Data columns: &quot;</span> &lt;&lt; vars[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; vars[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00188"></a>00188             &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; vars[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; vars[1] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>
<a name="l00189"></a>00189             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="comment">// If no user-specified sample space extents, output pdf map directly</span>
<a name="l00192"></a>00192   <span class="keywordflow">if</span> (uext.empty()) {
<a name="l00193"></a>00193     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map())
<a name="l00194"></a>00194       m_outFile &lt;&lt; binsize[0] * static_cast&lt;tk::real&gt;(p.first[0]) &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00195"></a>00195                 &lt;&lt; binsize[1] * <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(p.first[1]) &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00196"></a>00196                 &lt;&lt; p.second / binsize[0] / binsize[1] /
<a name="l00197"></a>00197                    static_cast&lt;tk::real&gt;(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample())
<a name="l00198"></a>00198                 &lt;&lt; std::endl;
<a name="l00199"></a>00199   } <span class="keywordflow">else</span> { <span class="comment">// If user-specified sample space extents, output outpdf array</span>
<a name="l00200"></a>00200     std::size_t bin = 0;
<a name="l00201"></a>00201     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : outpdf) {
<a name="l00202"></a>00202       m_outFile &lt;&lt; binsize[0] * static_cast&lt;tk::real&gt;(bin % nbix) + uext[0]
<a name="l00203"></a>00203                 &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00204"></a>00204                 &lt;&lt; binsize[1] * static_cast&lt;tk::real&gt;(bin / nbix) + uext[2]
<a name="l00205"></a>00205                 &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00206"></a>00206                 &lt;&lt; p
<a name="l00207"></a>00207                 &lt;&lt; std::endl;
<a name="l00208"></a>00208       ++bin;
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210   }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="keywordtype">void</span>
<a name="l00216"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a9a0572ffefffc20b60111327e220e3a6">00216</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a1f798f74e0d815b8bc9e409fbc7da85c" title="Write univariate PDF to text file.">PDFWriter::writeTxt</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_tri_p_d_f.html" title="Joint trivariate PDF estimator.">TriPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, <span class="keyword">const</span> <a class="code" href="structtk_1_1ctr_1_1_p_d_f_info.html" title="PDF information bundle.">tk::ctr::PDFInfo</a>&amp; info ) <span class="keyword">const</span>
<a name="l00217"></a>00217 <span class="comment">//******************************************************************************</span>
<a name="l00218"></a>00218 <span class="comment">//  Write out standardized trivariate PDF to text file</span><span class="comment"></span>
<a name="l00219"></a>00219 <span class="comment">//! \param[in] pdf Trivariate PDF</span>
<a name="l00220"></a>00220 <span class="comment">//! \param[in] info PDF metadata</span>
<a name="l00221"></a>00221 <span class="comment">//! \author J. Bakosi</span>
<a name="l00222"></a>00222 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; name = info.name;
<a name="l00225"></a>00225   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; uext = info.exts;
<a name="l00226"></a>00226   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> = info.vars;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   assertSampleSpaceDimensions&lt; 3 &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> );
<a name="l00229"></a>00229   assertSampleSpaceExtents&lt; 3 &gt;( uext );
<a name="l00230"></a>00230 
<a name="l00231"></a>00231   <span class="comment">// Query and optionally override number of bins and minima of sample space if</span>
<a name="l00232"></a>00232   <span class="comment">// user-specified extents were given and copy probabilities from pdf to a</span>
<a name="l00233"></a>00233   <span class="comment">// logically 3D array for output</span>
<a name="l00234"></a>00234   std::size_t nbix, nbiy, nbiz;
<a name="l00235"></a>00235   tk::real xmin, xmax, ymin, ymax, zmin, zmax;
<a name="l00236"></a>00236   std::vector&lt; tk::real &gt; outpdf;
<a name="l00237"></a>00237   std::array&lt; tk::real, 3 &gt; binsize;
<a name="l00238"></a>00238   std::array&lt; long, 2*TriPDF::dim &gt; ext;
<a name="l00239"></a>00239   extents( <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, uext, nbix, nbiy, nbiz, xmin, xmax, ymin, ymax, zmin, zmax,
<a name="l00240"></a>00240            binsize, ext, outpdf, <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15a8184d7d989393ae3d20f936f08dff89b">ctr::PDFCenteringType::ELEM</a> );
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <span class="comment">// Output header</span>
<a name="l00243"></a>00243   m_outFile &lt;&lt; <span class="stringliteral">&quot;# vim: filetype=sh:\n#\n&quot;</span>
<a name="l00244"></a>00244             &lt;&lt; <span class="stringliteral">&quot;# Joint trivariate PDF: &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span>
<a name="l00245"></a>00245             &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[2] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>
<a name="l00246"></a>00246             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00247"></a>00247             &lt;&lt; <span class="stringliteral">&quot;# Numeric precision: &quot;</span> &lt;&lt; m_outFile.precision() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00248"></a>00248             &lt;&lt; <span class="stringliteral">&quot;# Bin sizes: &quot;</span> &lt;&lt; binsize[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; binsize[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00249"></a>00249             &lt;&lt; binsize[2] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00250"></a>00250             &lt;&lt; <span class="stringliteral">&quot;# Number of bins estimated: &quot;</span> &lt;&lt; ext[1] - ext[0] + 1 &lt;&lt; <span class="stringliteral">&quot; x &quot;</span>
<a name="l00251"></a>00251             &lt;&lt; ext[3] - ext[2] + 1 &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; ext[5] - ext[4] + 1 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00252"></a>00252             &lt;&lt; <span class="stringliteral">&quot;# Number of bins output: &quot;</span> &lt;&lt; nbix &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; nbiy &lt;&lt; <span class="stringliteral">&quot; x &quot;</span>
<a name="l00253"></a>00253             &lt;&lt; nbiz &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00254"></a>00254             &lt;&lt; <span class="stringliteral">&quot;# Sample space extents: [&quot;</span> &lt;&lt; xmin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; xmax &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span>
<a name="l00255"></a>00255             &lt;&lt; ymin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; ymax &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span> &lt;&lt; zmin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; zmax
<a name="l00256"></a>00256             &lt;&lt; <span class="stringliteral">&quot;]\n#\n&quot;</span>
<a name="l00257"></a>00257             &lt;&lt; <span class="stringliteral">&quot;# Example step-by-step visualization with gnuplot\n&quot;</span>
<a name="l00258"></a>00258             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00259"></a>00259             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set grid\n&quot;</span>
<a name="l00260"></a>00260             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set xlabel \&quot;&quot;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>
<a name="l00261"></a>00261             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set ylabel \&quot;&quot;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>
<a name="l00262"></a>00262             &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set zlabel \&quot;&quot;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[2] &lt;&lt; <span class="stringliteral">&quot;\&quot;\n&quot;</span>;
<a name="l00263"></a>00263   <span class="keywordflow">if</span> (!uext.empty())
<a name="l00264"></a>00264     m_outFile &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set xrange [&quot;</span> &lt;&lt; uext[0] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[1] &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00265"></a>00265               &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set yrange [&quot;</span> &lt;&lt; uext[2] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[3] &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00266"></a>00266               &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; set zrange [&quot;</span> &lt;&lt; uext[4] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[5] &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;
<a name="l00267"></a>00267   m_outFile &lt;&lt; <span class="stringliteral">&quot;# gnuplot&gt; splot \&quot;&quot;</span> &lt;&lt; m_filename &lt;&lt; <span class="stringliteral">&quot;\&quot; pointtype 7 &quot;</span>
<a name="l00268"></a>00268                <span class="stringliteral">&quot;linecolor palette title \&quot;&quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; vars[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span>
<a name="l00269"></a>00269             &lt;&lt; vars[1] &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; vars[2] &lt;&lt; <span class="stringliteral">&quot;)\&quot;\n#\n&quot;</span>
<a name="l00270"></a>00270             &lt;&lt; <span class="stringliteral">&quot;# Gnuplot one-liner for quick copy-paste\n&quot;</span>
<a name="l00271"></a>00271             &lt;&lt; <span class="stringliteral">&quot;# --------------------------------------\n&quot;</span>
<a name="l00272"></a>00272             &lt;&lt; <span class="stringliteral">&quot;# set grid; set xlabel \&quot;&quot;</span> &lt;&lt; vars[0] &lt;&lt; <span class="stringliteral">&quot;\&quot;; set ylabel \&quot;&quot;</span>
<a name="l00273"></a>00273             &lt;&lt; vars[1] &lt;&lt; <span class="stringliteral">&quot;\&quot;; set zlabel \&quot;&quot;</span> &lt;&lt; vars[2] &lt;&lt; <span class="stringliteral">&quot;\&quot;; &quot;</span>;
<a name="l00274"></a>00274   <span class="keywordflow">if</span> (!uext.empty())
<a name="l00275"></a>00275     m_outFile &lt;&lt; <span class="stringliteral">&quot;set xrange [&quot;</span> &lt;&lt; uext[0] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[1] &lt;&lt; <span class="stringliteral">&quot;]; set yrange &quot;</span>
<a name="l00276"></a>00276                  <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; uext[2] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[3] &lt;&lt; <span class="stringliteral">&quot;]; set zrange [&quot;</span>
<a name="l00277"></a>00277               &lt;&lt; uext[4] &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; uext[5] &lt;&lt; <span class="stringliteral">&quot;]; &quot;</span>;
<a name="l00278"></a>00278   m_outFile &lt;&lt; <span class="stringliteral">&quot;splot \&quot;&quot;</span> &lt;&lt; m_filename &lt;&lt; <span class="stringliteral">&quot;\&quot; pt 7 linecolor palette title \&quot;&quot;</span>
<a name="l00279"></a>00279             &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; vars[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; vars[1] &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; vars[2] &lt;&lt; <span class="charliteral">&#39;)&#39;</span>
<a name="l00280"></a>00280             &lt;&lt; <span class="stringliteral">&quot;\&quot;\n#\n&quot;</span>
<a name="l00281"></a>00281             &lt;&lt; <span class="stringliteral">&quot;# Data columns: &quot;</span> &lt;&lt; vars[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; vars[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00282"></a>00282             &lt;&lt; vars[2] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; vars[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; vars[1]
<a name="l00283"></a>00283             &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; vars[2] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>
<a name="l00284"></a>00284             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286   <span class="comment">// If no user-specified sample space extents, output pdf map directly</span>
<a name="l00287"></a>00287   <span class="keywordflow">if</span> (uext.empty()) {
<a name="l00288"></a>00288     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map())
<a name="l00289"></a>00289       m_outFile &lt;&lt; binsize[0] * static_cast&lt;tk::real&gt;(p.first[0]) &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00290"></a>00290                 &lt;&lt; binsize[1] * <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(p.first[1]) &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00291"></a>00291                 &lt;&lt; binsize[2] * static_cast&lt;tk::real&gt;(p.first[2]) &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00292"></a>00292                 &lt;&lt; p.second / binsize[0] / binsize[1] / binsize[2]
<a name="l00293"></a>00293                             / <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample())
<a name="l00294"></a>00294                 &lt;&lt; std::endl;
<a name="l00295"></a>00295   } <span class="keywordflow">else</span> { <span class="comment">// If user-specified sample space extents, output outpdf array</span>
<a name="l00296"></a>00296     std::size_t bin = 0;
<a name="l00297"></a>00297     <span class="keyword">const</span> <span class="keyword">auto</span> n = nbix*nbiy;
<a name="l00298"></a>00298     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : outpdf) {
<a name="l00299"></a>00299       m_outFile &lt;&lt; binsize[0] * static_cast&lt;tk::real&gt;(bin % n % nbix) + uext[0]
<a name="l00300"></a>00300                 &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00301"></a>00301                 &lt;&lt; binsize[1] * static_cast&lt;tk::real&gt;(bin % n / nbix) + uext[2]
<a name="l00302"></a>00302                 &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00303"></a>00303                 &lt;&lt; binsize[2] * <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(bin / n) + uext[4] &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00304"></a>00304                 &lt;&lt; p
<a name="l00305"></a>00305                 &lt;&lt; std::endl;
<a name="l00306"></a>00306       ++bin;
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308   }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <span class="keywordtype">void</span>
<a name="l00314"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a008d30e8fbef66672f922e507cebe481">00314</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a008d30e8fbef66672f922e507cebe481" title="Write bivariate PDF to gmsh (text) file format.">PDFWriter::writeGmshTxt</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_bi_p_d_f.html" title="Joint bivariate PDF estimator.">BiPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>,
<a name="l00315"></a>00315                          <span class="keyword">const</span> <a class="code" href="structtk_1_1ctr_1_1_p_d_f_info.html" title="PDF information bundle.">tk::ctr::PDFInfo</a>&amp; info,
<a name="l00316"></a>00316                          <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15">ctr::PDFCenteringType</a> centering ) <span class="keyword">const</span>
<a name="l00317"></a>00317 <span class="comment">//******************************************************************************</span>
<a name="l00318"></a>00318 <span class="comment">//  Write out standardized bivariate PDF to Gmsh (text) format</span><span class="comment"></span>
<a name="l00319"></a>00319 <span class="comment">//! \param[in] pdf Bivariate PDF</span>
<a name="l00320"></a>00320 <span class="comment">//! \param[in] info PDF metadata</span>
<a name="l00321"></a>00321 <span class="comment">//! \param[in] centering Bin centering on sample space mesh</span>
<a name="l00322"></a>00322 <span class="comment">//! \author J. Bakosi</span>
<a name="l00323"></a>00323 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; name = info.name;
<a name="l00326"></a>00326   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; uext = info.exts;
<a name="l00327"></a>00327   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> = info.vars;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   assertSampleSpaceDimensions&lt; 2 &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> );
<a name="l00330"></a>00330   assertSampleSpaceExtents&lt; 2 &gt;( uext );
<a name="l00331"></a>00331 
<a name="l00332"></a>00332   <span class="comment">// Query and optionally override number of bins and minima of sample space if</span>
<a name="l00333"></a>00333   <span class="comment">// user-specified extents were given and copy probabilities from pdf to a</span>
<a name="l00334"></a>00334   <span class="comment">// logically 2D array for output</span>
<a name="l00335"></a>00335   std::size_t nbix, nbiy;
<a name="l00336"></a>00336   tk::real xmin, xmax, ymin, ymax;
<a name="l00337"></a>00337   std::vector&lt; tk::real &gt; outpdf;
<a name="l00338"></a>00338   std::array&lt; tk::real, 2 &gt; binsize;
<a name="l00339"></a>00339   std::array&lt; long, 2*BiPDF::dim &gt; ext;
<a name="l00340"></a>00340   extents( <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, uext, nbix, nbiy, xmin, xmax, ymin, ymax, binsize, ext, outpdf,
<a name="l00341"></a>00341            centering );
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   <span class="comment">// Output metadata. The #s are unnecessary, but vi will color it differently.</span>
<a name="l00344"></a>00344   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Comments\n&quot;</span>
<a name="l00345"></a>00345             &lt;&lt; <span class="stringliteral">&quot;# vim: filetype=sh:\n&quot;</span>
<a name="l00346"></a>00346             &lt;&lt; <span class="stringliteral">&quot;# Joint bivariate PDF: &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span>
<a name="l00347"></a>00347             &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>
<a name="l00348"></a>00348             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00349"></a>00349             &lt;&lt; <span class="stringliteral">&quot;# Numeric precision: &quot;</span> &lt;&lt; m_outFile.precision() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00350"></a>00350             &lt;&lt; <span class="stringliteral">&quot;# Bin sizes: &quot;</span> &lt;&lt; binsize[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; binsize[1] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00351"></a>00351             &lt;&lt; <span class="stringliteral">&quot;# Number of bins estimated: &quot;</span> &lt;&lt; ext[1] - ext[0] + 1 &lt;&lt; <span class="stringliteral">&quot; x &quot;</span>
<a name="l00352"></a>00352             &lt;&lt; ext[3] - ext[2] + 1 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00353"></a>00353             &lt;&lt; <span class="stringliteral">&quot;# Number of bins output: &quot;</span> &lt;&lt; nbix &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; nbiy &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00354"></a>00354             &lt;&lt; <span class="stringliteral">&quot;# Sample space extents: [&quot;</span> &lt;&lt; xmin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; xmax
<a name="l00355"></a>00355             &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span> &lt;&lt; ymin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; ymax &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00356"></a>00356             &lt;&lt; <span class="stringliteral">&quot;$EndComments\n&quot;</span>;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358   <span class="comment">// Output mesh header: mesh version, file type, data size</span>
<a name="l00359"></a>00359   m_outFile &lt;&lt; <span class="stringliteral">&quot;$MeshFormat\n2.2 0 8\n$EndMeshFormat\n&quot;</span>;
<a name="l00360"></a>00360   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00361"></a>00361 
<a name="l00362"></a>00362   <span class="comment">// Output grid points of discretized sample space (2D Cartesian grid)</span>
<a name="l00363"></a>00363   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Nodes\n&quot;</span> &lt;&lt; (nbix+1)*(nbiy+1) &lt;&lt; std::endl;
<a name="l00364"></a>00364   <span class="keywordtype">int</span> k=0;
<a name="l00365"></a>00365   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;=nbiy; i++) {
<a name="l00366"></a>00366     tk::real y = ymin + i*binsize[1];
<a name="l00367"></a>00367     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;=nbix; j++) {
<a name="l00368"></a>00368       tk::real x = xmin + j*binsize[0];
<a name="l00369"></a>00369       m_outFile &lt;&lt; ++k &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; x &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; y &lt;&lt; <span class="stringliteral">&quot; 0\n&quot;</span>;
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371   }
<a name="l00372"></a>00372   m_outFile &lt;&lt; <span class="stringliteral">&quot;$EndNodes\n&quot;</span>;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="comment">// Output elements of discretized sample space (2D Cartesian grid)</span>
<a name="l00375"></a>00375   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Elements\n&quot;</span> &lt;&lt; nbix*nbiy &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00376"></a>00376   <span class="keywordflow">for</span> (std::size_t i=0; i&lt;nbix*nbiy; ++i) {
<a name="l00377"></a>00377     <span class="keyword">const</span> <span class="keyword">auto</span> y = i/nbix;
<a name="l00378"></a>00378     m_outFile &lt;&lt; i+1 &lt;&lt; <span class="stringliteral">&quot; 3 2 1 1 &quot;</span> &lt;&lt; i+y+1 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; i+y+2 &lt;&lt; <span class="charliteral">&#39; &#39;</span>
<a name="l00379"></a>00379               &lt;&lt; i+y+nbix+3 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; i+y+nbix+2 &lt;&lt; std::endl;
<a name="l00380"></a>00380   }
<a name="l00381"></a>00381   m_outFile &lt;&lt; <span class="stringliteral">&quot;$EndElements\n&quot;</span>;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   <span class="comment">// Output PDF function values in element or node centers</span>
<a name="l00384"></a>00384   std::string c( <span class="stringliteral">&quot;Element&quot;</span> );
<a name="l00385"></a>00385   <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) {
<a name="l00386"></a>00386     ++nbix; ++nbiy;
<a name="l00387"></a>00387     c = <span class="stringliteral">&quot;Node&quot;</span>;
<a name="l00388"></a>00388   }
<a name="l00389"></a>00389   m_outFile &lt;&lt; <span class="charliteral">&#39;$&#39;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;Data\n1\n\&quot;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;\&quot;\n1\n0.0\n3\n0\n1\n&quot;</span>
<a name="l00390"></a>00390             &lt;&lt; nbix*nbiy &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   <span class="comment">// If no user-specified sample space extents, output pdf map directly</span>
<a name="l00393"></a>00393   <span class="keywordflow">if</span> (uext.empty()) {
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     std::vector&lt; bool &gt; out( nbix*nbiy, <span class="keyword">false</span> ); <span class="comment">// indicate bins filled</span>
<a name="l00396"></a>00396     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map()) {
<a name="l00397"></a>00397       <span class="keyword">const</span> <span class="keyword">auto</span> bin = (p.first[1] - ext[2]) * static_cast&lt;long&gt;(nbix) +
<a name="l00398"></a>00398                        (p.first[0] - ext[0]) % static_cast&lt;long&gt;(nbix);
<a name="l00399"></a>00399       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &gt;= 0, <span class="stringliteral">&quot;Bin underflow in PDFWriter::writeGmshTxt().&quot;</span> );
<a name="l00400"></a>00400       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &lt; nbix*nbiy, <span class="stringliteral">&quot;Bin overflow in PDFWriter::writeGmshTxt().&quot;</span> );
<a name="l00401"></a>00401       out[ <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(bin) ] = <span class="keyword">true</span>;
<a name="l00402"></a>00402       m_outFile &lt;&lt; bin+1 &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00403"></a>00403                 &lt;&lt; p.second / binsize[0] / binsize[1]
<a name="l00404"></a>00404                             / <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample())
<a name="l00405"></a>00405                 &lt;&lt; std::endl;
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407     <span class="comment">// Output bins nonexistent in PDF (gmsh sometimes fails to plot the exiting</span>
<a name="l00408"></a>00408     <span class="comment">// bins if holes exist in the data, it also looks better as zero than holes)</span>
<a name="l00409"></a>00409     <span class="keywordflow">for</span> (std::size_t i=0; i&lt;out.size(); ++i)
<a name="l00410"></a>00410       <span class="keywordflow">if</span> (!out[i]) m_outFile &lt;&lt; i+1 &lt;&lt; <span class="stringliteral">&quot;\t0&quot;</span> &lt;&lt; std::endl;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412   } <span class="keywordflow">else</span> { <span class="comment">// If user-specified sample space extents, output outpdf array</span>
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     std::size_t bin = 0;
<a name="l00415"></a>00415     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : outpdf) m_outFile &lt;&lt; ++bin &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; p &lt;&lt; std::endl;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417   }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419   m_outFile &lt;&lt; <span class="stringliteral">&quot;$End&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;Data\n&quot;</span>;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="keywordtype">void</span>
<a name="l00425"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#af2a0728ea2308ddde703ba63abb72ffc">00425</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a008d30e8fbef66672f922e507cebe481" title="Write bivariate PDF to gmsh (text) file format.">PDFWriter::writeGmshTxt</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_tri_p_d_f.html" title="Joint trivariate PDF estimator.">TriPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>,
<a name="l00426"></a>00426                          <span class="keyword">const</span> <a class="code" href="structtk_1_1ctr_1_1_p_d_f_info.html" title="PDF information bundle.">tk::ctr::PDFInfo</a>&amp; info,
<a name="l00427"></a>00427                          <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15">ctr::PDFCenteringType</a> centering ) <span class="keyword">const</span>
<a name="l00428"></a>00428 <span class="comment">//******************************************************************************</span>
<a name="l00429"></a>00429 <span class="comment">//  Write out standardized trivariate PDF to Gmsh (text) format</span><span class="comment"></span>
<a name="l00430"></a>00430 <span class="comment">//! \param[in] pdf Trivariate PDF</span>
<a name="l00431"></a>00431 <span class="comment">//! \param[in] info PDF metadata</span>
<a name="l00432"></a>00432 <span class="comment">//! \param[in] centering Bin centering on sample space mesh</span>
<a name="l00433"></a>00433 <span class="comment">//! \author J. Bakosi</span>
<a name="l00434"></a>00434 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; name = info.name;
<a name="l00437"></a>00437   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; uext = info.exts;
<a name="l00438"></a>00438   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> = info.vars;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440   assertSampleSpaceDimensions&lt; 3 &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> );
<a name="l00441"></a>00441   assertSampleSpaceExtents&lt; 3 &gt;( uext );
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   <span class="comment">// Query and optionally override number of bins and minima of sample space if</span>
<a name="l00444"></a>00444   <span class="comment">// user-specified extents were given and copy probabilities from pdf to a</span>
<a name="l00445"></a>00445   <span class="comment">// logically 3D array for output</span>
<a name="l00446"></a>00446   std::size_t nbix, nbiy, nbiz;
<a name="l00447"></a>00447   tk::real xmin, xmax, ymin, ymax, zmin, zmax;
<a name="l00448"></a>00448   std::vector&lt; tk::real &gt; outpdf;
<a name="l00449"></a>00449   std::array&lt; tk::real, 3 &gt; binsize;
<a name="l00450"></a>00450   std::array&lt; long, 2*TriPDF::dim &gt; ext;
<a name="l00451"></a>00451   extents( <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, uext, nbix, nbiy, nbiz, xmin, xmax, ymin, ymax, zmin, zmax,
<a name="l00452"></a>00452            binsize, ext, outpdf, centering );
<a name="l00453"></a>00453 
<a name="l00454"></a>00454   <span class="comment">// Output metadata. The #s are unnecessary, but vi will color it differently.</span>
<a name="l00455"></a>00455   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Comments\n&quot;</span>
<a name="l00456"></a>00456             &lt;&lt; <span class="stringliteral">&quot;# vim: filetype=sh:\n#\n&quot;</span>
<a name="l00457"></a>00457             &lt;&lt; <span class="stringliteral">&quot;# Joint trivariate PDF: &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span>
<a name="l00458"></a>00458             &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[2] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>
<a name="l00459"></a>00459             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00460"></a>00460             &lt;&lt; <span class="stringliteral">&quot;# Numeric precision: &quot;</span> &lt;&lt; m_outFile.precision() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00461"></a>00461             &lt;&lt; <span class="stringliteral">&quot;# Bin sizes: &quot;</span> &lt;&lt; binsize[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; binsize[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00462"></a>00462             &lt;&lt; binsize[2] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00463"></a>00463             &lt;&lt; <span class="stringliteral">&quot;# Number of bins estimated: &quot;</span> &lt;&lt; ext[1] - ext[0] + 1 &lt;&lt; <span class="stringliteral">&quot; x &quot;</span>
<a name="l00464"></a>00464             &lt;&lt; ext[3] - ext[2] + 1 &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; ext[5] - ext[4] + 1 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00465"></a>00465             &lt;&lt; <span class="stringliteral">&quot;# Number of bins output: &quot;</span> &lt;&lt; nbix &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; nbiy &lt;&lt; <span class="stringliteral">&quot; x &quot;</span>
<a name="l00466"></a>00466             &lt;&lt; nbiz &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00467"></a>00467             &lt;&lt; <span class="stringliteral">&quot;# Sample space extents: [&quot;</span> &lt;&lt; xmin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; xmax &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span>
<a name="l00468"></a>00468             &lt;&lt; ymin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; ymax &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span> &lt;&lt; zmin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; zmax &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00469"></a>00469             &lt;&lt; <span class="stringliteral">&quot;$EndComments\n&quot;</span>;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471   <span class="comment">// Output mesh header: mesh version, file type, data size</span>
<a name="l00472"></a>00472   m_outFile &lt;&lt; <span class="stringliteral">&quot;$MeshFormat\n2.2 0 8\n$EndMeshFormat\n&quot;</span>;
<a name="l00473"></a>00473   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <span class="comment">// Output grid points of discretized sample space (3D Cartesian grid)</span>
<a name="l00476"></a>00476   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Nodes\n&quot;</span> &lt;&lt; (nbix+1)*(nbiy+1)*(nbiz+1) &lt;&lt; std::endl;
<a name="l00477"></a>00477   <span class="keywordtype">int</span> l=0;
<a name="l00478"></a>00478   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;=nbiz; k++) {
<a name="l00479"></a>00479     tk::real z = zmin + k*binsize[2];
<a name="l00480"></a>00480     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;=nbiy; j++) {
<a name="l00481"></a>00481       tk::real y = ymin + j*binsize[1];
<a name="l00482"></a>00482       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;=nbix; i++) {
<a name="l00483"></a>00483         tk::real x = xmin + i*binsize[0];
<a name="l00484"></a>00484         m_outFile &lt;&lt; ++l &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; x &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; y &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; z &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00485"></a>00485       }
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487   }
<a name="l00488"></a>00488   m_outFile &lt;&lt; <span class="stringliteral">&quot;$EndNodes\n&quot;</span>;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490   <span class="comment">// Output elements of discretized sample space (3D Cartesian grid)</span>
<a name="l00491"></a>00491   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Elements\n&quot;</span> &lt;&lt; nbix*nbiy*nbiz &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00492"></a>00492   <span class="keyword">const</span> <span class="keyword">auto</span> n = nbix*nbiy;
<a name="l00493"></a>00493   <span class="keyword">const</span> <span class="keyword">auto</span> p = (nbix+1)*(nbiy+1);
<a name="l00494"></a>00494   <span class="keywordflow">for</span> (std::size_t i=0; i&lt;nbix*nbiy*nbiz; ++i) {
<a name="l00495"></a>00495     <span class="keyword">const</span> <span class="keyword">auto</span> y = i/nbix + i/n*(nbix+1);
<a name="l00496"></a>00496     m_outFile &lt;&lt; i+1 &lt;&lt; <span class="stringliteral">&quot; 5 2 1 1 &quot;</span> &lt;&lt; i+y+1 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; i+y+2 &lt;&lt; <span class="charliteral">&#39; &#39;</span>
<a name="l00497"></a>00497               &lt;&lt; i+y+nbix+3 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; i+y+nbix+2 &lt;&lt; <span class="charliteral">&#39; &#39;</span>
<a name="l00498"></a>00498               &lt;&lt; i+y+p+1 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; i+y+p+2 &lt;&lt; <span class="charliteral">&#39; &#39;</span>
<a name="l00499"></a>00499               &lt;&lt; i+y+p+nbix+3 &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; i+y+p+nbix+2 &lt;&lt; <span class="charliteral">&#39; &#39;</span>
<a name="l00500"></a>00500               &lt;&lt; std::endl;
<a name="l00501"></a>00501   }
<a name="l00502"></a>00502   m_outFile &lt;&lt; <span class="stringliteral">&quot;$EndElements\n&quot;</span>;
<a name="l00503"></a>00503 
<a name="l00504"></a>00504   <span class="comment">// Output PDF function values in element or node centers</span>
<a name="l00505"></a>00505   std::string c( <span class="stringliteral">&quot;Element&quot;</span> );
<a name="l00506"></a>00506   <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) {
<a name="l00507"></a>00507     ++nbix; ++nbiy; ++nbiz;
<a name="l00508"></a>00508     c = <span class="stringliteral">&quot;Node&quot;</span>;
<a name="l00509"></a>00509   }
<a name="l00510"></a>00510   m_outFile &lt;&lt; <span class="charliteral">&#39;$&#39;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;Data\n1\n\&quot;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;\&quot;\n1\n0.0\n3\n0\n1\n&quot;</span>
<a name="l00511"></a>00511             &lt;&lt; nbix*nbiy*nbiz &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513   <span class="comment">// If no user-specified sample space extents, output pdf map directly</span>
<a name="l00514"></a>00514   <span class="keywordflow">if</span> (uext.empty()) {
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     std::vector&lt; bool &gt; out( nbix*nbiy*nbiz, <span class="keyword">false</span> ); <span class="comment">// indicate bins filled</span>
<a name="l00517"></a>00517     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map()) {
<a name="l00518"></a>00518       <span class="keyword">const</span> <span class="keyword">auto</span> bin = (p.first[2] - ext[4]) * static_cast&lt;long&gt;(nbix*nbiy) +
<a name="l00519"></a>00519                        (p.first[1] - ext[2]) * static_cast&lt;long&gt;(nbix) +
<a name="l00520"></a>00520                        (p.first[0] - ext[0]) % static_cast&lt;long&gt;(nbix);
<a name="l00521"></a>00521       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &gt;= 0, <span class="stringliteral">&quot;Bin underflow in PDFWriter::writeGmshTxt().&quot;</span> );
<a name="l00522"></a>00522       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &lt; nbix*nbiy*nbiz,
<a name="l00523"></a>00523               <span class="stringliteral">&quot;Bin overflow in PDFWriter::writeGmshTxt().&quot;</span> );
<a name="l00524"></a>00524       out[ <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(bin) ] = <span class="keyword">true</span>;
<a name="l00525"></a>00525       m_outFile &lt;&lt; bin+1 &lt;&lt; <span class="charliteral">&#39;\t&#39;</span>
<a name="l00526"></a>00526                 &lt;&lt; p.second / binsize[0] / binsize[1] / binsize[2]
<a name="l00527"></a>00527                             / <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample())
<a name="l00528"></a>00528                 &lt;&lt; std::endl;
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530     <span class="comment">// Output bins nonexistent in PDF (gmsh sometimes fails to plot the exiting</span>
<a name="l00531"></a>00531     <span class="comment">// bins if holes exist in the data, it also looks better as zero than holes)</span>
<a name="l00532"></a>00532     <span class="keywordflow">for</span> (std::size_t i=0; i&lt;out.size(); ++i)
<a name="l00533"></a>00533       <span class="keywordflow">if</span> (!out[i]) m_outFile &lt;&lt; i+1 &lt;&lt; <span class="stringliteral">&quot;\t0&quot;</span> &lt;&lt; std::endl;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535   } <span class="keywordflow">else</span> { <span class="comment">// If user-specified sample space extents, output outpdf array</span>
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     std::size_t bin = 0;
<a name="l00538"></a>00538     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : outpdf) m_outFile &lt;&lt; ++bin &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; p &lt;&lt; std::endl;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540   }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542   m_outFile &lt;&lt; <span class="stringliteral">&quot;$End&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;Data\n&quot;</span>;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00545"></a>00545 }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="keywordtype">void</span>
<a name="l00548"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a739e93034fb1c506b1adbb7e57d771a4">00548</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a739e93034fb1c506b1adbb7e57d771a4" title="Write bivariate PDF to gmsh (binary) file format.">PDFWriter::writeGmshBin</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_bi_p_d_f.html" title="Joint bivariate PDF estimator.">BiPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>,
<a name="l00549"></a>00549                          <span class="keyword">const</span> <a class="code" href="structtk_1_1ctr_1_1_p_d_f_info.html" title="PDF information bundle.">tk::ctr::PDFInfo</a>&amp; info,
<a name="l00550"></a>00550                          <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15">ctr::PDFCenteringType</a> centering ) <span class="keyword">const</span>
<a name="l00551"></a>00551 <span class="comment">//******************************************************************************</span>
<a name="l00552"></a>00552 <span class="comment">//  Write out standardized bivariate PDF to Gmsh (binary) format</span><span class="comment"></span>
<a name="l00553"></a>00553 <span class="comment">//! \param[in] pdf Bivariate PDF</span>
<a name="l00554"></a>00554 <span class="comment">//! \param[in] info PDF metadata</span>
<a name="l00555"></a>00555 <span class="comment">//! \param[in] centering Bin centering on sample space mesh</span>
<a name="l00556"></a>00556 <span class="comment">//! \author J. Bakosi</span>
<a name="l00557"></a>00557 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00558"></a>00558 {
<a name="l00559"></a>00559   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; name = info.name;
<a name="l00560"></a>00560   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; uext = info.exts;
<a name="l00561"></a>00561   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> = info.vars;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563   assertSampleSpaceDimensions&lt; 2 &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> );
<a name="l00564"></a>00564   assertSampleSpaceExtents&lt; 2 &gt;( uext );
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <span class="comment">// Query and optionally override number of bins and minima of sample space if</span>
<a name="l00567"></a>00567   <span class="comment">// user-specified extents were given and copy probabilities from pdf to a</span>
<a name="l00568"></a>00568   <span class="comment">// logically 2D array for output</span>
<a name="l00569"></a>00569   std::size_t nbix, nbiy;
<a name="l00570"></a>00570   tk::real xmin, xmax, ymin, ymax;
<a name="l00571"></a>00571   std::vector&lt; tk::real &gt; outpdf;
<a name="l00572"></a>00572   std::array&lt; tk::real, 2 &gt; binsize;
<a name="l00573"></a>00573   std::array&lt; long, 2*BiPDF::dim &gt; ext;
<a name="l00574"></a>00574   extents( <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, uext, nbix, nbiy, xmin, xmax, ymin, ymax, binsize, ext, outpdf,
<a name="l00575"></a>00575            centering );
<a name="l00576"></a>00576 
<a name="l00577"></a>00577   <span class="comment">// Output metadata. The #s are unnecessary, but vi will color it differently.</span>
<a name="l00578"></a>00578   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Comments\n&quot;</span>
<a name="l00579"></a>00579             &lt;&lt; <span class="stringliteral">&quot;# vim: filetype=sh:\n&quot;</span>
<a name="l00580"></a>00580             &lt;&lt; <span class="stringliteral">&quot;# Joint bivariate PDF: &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span>
<a name="l00581"></a>00581             &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>
<a name="l00582"></a>00582             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00583"></a>00583             &lt;&lt; <span class="stringliteral">&quot;# Numeric precision: 64-bit binary\n&quot;</span>
<a name="l00584"></a>00584             &lt;&lt; <span class="stringliteral">&quot;# Bin sizes: &quot;</span> &lt;&lt; binsize[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; binsize[1] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00585"></a>00585             &lt;&lt; <span class="stringliteral">&quot;# Number of bins estimated: &quot;</span> &lt;&lt; ext[1] - ext[0] + 1 &lt;&lt; <span class="stringliteral">&quot; x &quot;</span>
<a name="l00586"></a>00586             &lt;&lt; ext[3] - ext[2] + 1 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00587"></a>00587             &lt;&lt; <span class="stringliteral">&quot;# Number of bins output: &quot;</span> &lt;&lt; nbix &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; nbiy &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00588"></a>00588             &lt;&lt; <span class="stringliteral">&quot;# Sample space extents: [&quot;</span> &lt;&lt; xmin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; xmax
<a name="l00589"></a>00589             &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span> &lt;&lt; ymin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; ymax &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00590"></a>00590             &lt;&lt; <span class="stringliteral">&quot;$EndComments\n&quot;</span>;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <span class="comment">// Output mesh header: mesh version, file type, data size</span>
<a name="l00593"></a>00593   m_outFile &lt;&lt; <span class="stringliteral">&quot;$MeshFormat\n2.2 1 8\n&quot;</span>;
<a name="l00594"></a>00594   <span class="keywordtype">int</span> one = 1;
<a name="l00595"></a>00595   m_outFile.write( reinterpret_cast&lt;char*&gt;(&amp;one), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00596"></a>00596   m_outFile &lt;&lt; <span class="stringliteral">&quot;\n$EndMeshFormat\n&quot;</span>;
<a name="l00597"></a>00597   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   <span class="comment">// Output grid points of discretized sample space (2D Cartesian grid)</span>
<a name="l00600"></a>00600   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Nodes\n&quot;</span> &lt;&lt; (nbix+1)*(nbiy+1) &lt;&lt; std::endl;
<a name="l00601"></a>00601   <span class="keywordtype">int</span> k = 0;
<a name="l00602"></a>00602   tk::real z = 0.0;
<a name="l00603"></a>00603   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;=nbiy; i++) {
<a name="l00604"></a>00604     tk::real y = ymin + i*binsize[1];
<a name="l00605"></a>00605     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;=nbix; j++) {
<a name="l00606"></a>00606       tk::real x = xmin + j*binsize[0];
<a name="l00607"></a>00607       ++k;
<a name="l00608"></a>00608       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;k ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00609"></a>00609       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;x ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00610"></a>00610       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;y ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00611"></a>00611       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;z ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613   }
<a name="l00614"></a>00614   m_outFile &lt;&lt; <span class="stringliteral">&quot;\n$EndNodes\n&quot;</span>;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616   <span class="comment">// Output elements of discretized sample space (2D Cartesian grid)</span>
<a name="l00617"></a>00617   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Elements\n&quot;</span> &lt;&lt; nbix*nbiy &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00618"></a>00618   <span class="keywordtype">int</span> type = 3;                 <span class="comment">// gmsh elem type: 4-node quadrangle</span>
<a name="l00619"></a>00619   std::size_t n = nbix*nbiy;    <span class="comment">// number of elements in (this single) block</span>
<a name="l00620"></a>00620   <span class="keywordtype">int</span> ntags = 2;                <span class="comment">// number of element tags</span>
<a name="l00621"></a>00621   m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;type ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00622"></a>00622   m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;n ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00623"></a>00623   m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;ntags ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00624"></a>00624   <span class="keywordflow">for</span> (std::size_t i=0; i&lt;n; ++i) {
<a name="l00625"></a>00625     <span class="keyword">const</span> <span class="keyword">auto</span> y = i/nbix;
<a name="l00626"></a>00626     <span class="keyword">auto</span> <span class="keywordtype">id</span> = i+1;
<a name="l00627"></a>00627     <span class="keywordtype">int</span> tag[2] = { 1, 1 };
<a name="l00628"></a>00628     <span class="keywordtype">int</span> con[4] = { <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+1 ),
<a name="l00629"></a>00629                    static_cast&lt; int &gt;( i+y+2 ),
<a name="l00630"></a>00630                    <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+nbix+3 ),
<a name="l00631"></a>00631                    static_cast&lt; int &gt;( i+y+nbix+2 ) };
<a name="l00632"></a>00632     m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;<span class="keywordtype">id</span> ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00633"></a>00633     m_outFile.write( reinterpret_cast&lt; char* &gt;( tag ), 2*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00634"></a>00634     m_outFile.write( reinterpret_cast&lt; char* &gt;( con ), 4*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00635"></a>00635   }
<a name="l00636"></a>00636   m_outFile &lt;&lt; <span class="stringliteral">&quot;\n$EndElements\n&quot;</span>;
<a name="l00637"></a>00637 
<a name="l00638"></a>00638   <span class="comment">// Output PDF function values in element or node centers</span>
<a name="l00639"></a>00639   std::string c( <span class="stringliteral">&quot;Element&quot;</span> );
<a name="l00640"></a>00640   <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) {
<a name="l00641"></a>00641     ++nbix; ++nbiy;
<a name="l00642"></a>00642     c = <span class="stringliteral">&quot;Node&quot;</span>;
<a name="l00643"></a>00643   }
<a name="l00644"></a>00644   m_outFile &lt;&lt; <span class="charliteral">&#39;$&#39;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;Data\n1\n\&quot;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;\&quot;\n1\n0.0\n3\n0\n1\n&quot;</span>
<a name="l00645"></a>00645             &lt;&lt; nbix*nbiy &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647   <span class="comment">// If no user-specified sample space extents, output pdf map directly</span>
<a name="l00648"></a>00648   <span class="keywordflow">if</span> (uext.empty()) {
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     std::vector&lt; bool &gt; out( nbix*nbiy, <span class="keyword">false</span> ); <span class="comment">// indicate bins filled</span>
<a name="l00651"></a>00651     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map()) {
<a name="l00652"></a>00652       <span class="keyword">const</span> <span class="keyword">auto</span> bin = (p.first[1] - ext[2]) * static_cast&lt;long&gt;(nbix) +
<a name="l00653"></a>00653                        (p.first[0] - ext[0]) % static_cast&lt;long&gt;(nbix);
<a name="l00654"></a>00654       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &gt;= 0, <span class="stringliteral">&quot;Bin underflow in PDFWriter::writeGmshBin().&quot;</span> );
<a name="l00655"></a>00655       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &lt; nbix*nbiy, <span class="stringliteral">&quot;Bin overflow in PDFWriter::writeGmshBin().&quot;</span> );
<a name="l00656"></a>00656       out[ <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(bin) ] = <span class="keyword">true</span>;
<a name="l00657"></a>00657       <span class="keyword">auto</span> <span class="keywordtype">id</span> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(bin+1);
<a name="l00658"></a>00658       tk::real prob = p.second / binsize[0] / binsize[1]
<a name="l00659"></a>00659                                / <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample());
<a name="l00660"></a>00660       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;<span class="keywordtype">id</span> ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00661"></a>00661       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;prob ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663     <span class="comment">// Output bins nonexistent in PDF (gmsh sometimes fails to plot the exiting</span>
<a name="l00664"></a>00664     <span class="comment">// bins if holes exist in the data, it also looks better as zero than holes)</span>
<a name="l00665"></a>00665     tk::real prob = 0.0;
<a name="l00666"></a>00666     <span class="keywordflow">for</span> (std::size_t i=0; i&lt;out.size(); ++i)
<a name="l00667"></a>00667       <span class="keywordflow">if</span> (!out[i]) {
<a name="l00668"></a>00668         <span class="keyword">auto</span> <span class="keywordtype">id</span> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(i+1);
<a name="l00669"></a>00669         m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;<span class="keywordtype">id</span> ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00670"></a>00670         m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;prob ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00671"></a>00671       }
<a name="l00672"></a>00672 
<a name="l00673"></a>00673   } <span class="keywordflow">else</span> { <span class="comment">// If user-specified sample space extents, output outpdf array</span>
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="keywordtype">int</span> bin = 0;
<a name="l00676"></a>00676     <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p : outpdf) {
<a name="l00677"></a>00677       ++bin;
<a name="l00678"></a>00678       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;bin ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00679"></a>00679       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;p ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682   }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   m_outFile &lt;&lt; <span class="stringliteral">&quot;$End&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;Data\n&quot;</span>;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <span class="keywordtype">void</span>
<a name="l00690"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a37505b9d24c467fd6164a9203a719a92">00690</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a739e93034fb1c506b1adbb7e57d771a4" title="Write bivariate PDF to gmsh (binary) file format.">PDFWriter::writeGmshBin</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_tri_p_d_f.html" title="Joint trivariate PDF estimator.">TriPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>,
<a name="l00691"></a>00691                          <span class="keyword">const</span> <a class="code" href="structtk_1_1ctr_1_1_p_d_f_info.html" title="PDF information bundle.">tk::ctr::PDFInfo</a>&amp; info,
<a name="l00692"></a>00692                          <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15">ctr::PDFCenteringType</a> centering ) <span class="keyword">const</span>
<a name="l00693"></a>00693 <span class="comment">//******************************************************************************</span>
<a name="l00694"></a>00694 <span class="comment">//  Write out standardized trivariate PDF to Gmsh (binary) format</span><span class="comment"></span>
<a name="l00695"></a>00695 <span class="comment">//! \param[in] pdf Trivariate PDF</span>
<a name="l00696"></a>00696 <span class="comment">//! \param[in] info PDF metadata</span>
<a name="l00697"></a>00697 <span class="comment">//! \param[in] centering Bin centering on sample space mesh</span>
<a name="l00698"></a>00698 <span class="comment">//! \author  J. Bakosi</span>
<a name="l00699"></a>00699 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00700"></a>00700 {
<a name="l00701"></a>00701   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; name = info.name;
<a name="l00702"></a>00702   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; uext = info.exts;
<a name="l00703"></a>00703   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> = info.vars;
<a name="l00704"></a>00704 
<a name="l00705"></a>00705   assertSampleSpaceDimensions&lt; 3 &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> );
<a name="l00706"></a>00706   assertSampleSpaceExtents&lt; 3 &gt;( uext );
<a name="l00707"></a>00707 
<a name="l00708"></a>00708   <span class="comment">// Query and optionally override number of bins and minima of sample space if</span>
<a name="l00709"></a>00709   <span class="comment">// user-specified extents were given and copy probabilities from pdf to a</span>
<a name="l00710"></a>00710   <span class="comment">// logically 3D array for output</span>
<a name="l00711"></a>00711   std::size_t nbix, nbiy, nbiz;
<a name="l00712"></a>00712   tk::real xmin, xmax, ymin, ymax, zmin, zmax;
<a name="l00713"></a>00713   std::vector&lt; tk::real &gt; outpdf;
<a name="l00714"></a>00714   std::array&lt; tk::real, 3 &gt; binsize;
<a name="l00715"></a>00715   std::array&lt; long, 2*TriPDF::dim &gt; ext;
<a name="l00716"></a>00716   extents( <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, uext, nbix, nbiy, nbiz, xmin, xmax, ymin, ymax, zmin, zmax,
<a name="l00717"></a>00717            binsize, ext, outpdf, centering );
<a name="l00718"></a>00718 
<a name="l00719"></a>00719   <span class="comment">// Output metadata. The #s are unnecessary, but vi will color it differently.</span>
<a name="l00720"></a>00720   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Comments\n&quot;</span>
<a name="l00721"></a>00721             &lt;&lt; <span class="stringliteral">&quot;# vim: filetype=sh:\n#\n&quot;</span>
<a name="l00722"></a>00722             &lt;&lt; <span class="stringliteral">&quot;# Joint trivariate PDF: &quot;</span> &lt;&lt; name &lt;&lt; <span class="charliteral">&#39;(&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] &lt;&lt; <span class="charliteral">&#39;,&#39;</span>
<a name="l00723"></a>00723             &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] &lt;&lt; <span class="charliteral">&#39;,&#39;</span> &lt;&lt; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[2] &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>
<a name="l00724"></a>00724             &lt;&lt; <span class="stringliteral">&quot;# -----------------------------------------------\n&quot;</span>
<a name="l00725"></a>00725             &lt;&lt; <span class="stringliteral">&quot;# Numeric precision: 64-bit binary\n&quot;</span>
<a name="l00726"></a>00726             &lt;&lt; <span class="stringliteral">&quot;# Bin sizes: &quot;</span> &lt;&lt; binsize[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; binsize[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00727"></a>00727             &lt;&lt; binsize[2] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00728"></a>00728             &lt;&lt; <span class="stringliteral">&quot;# Number of bins estimated: &quot;</span> &lt;&lt; ext[1] - ext[0] + 1 &lt;&lt; <span class="stringliteral">&quot; x &quot;</span>
<a name="l00729"></a>00729             &lt;&lt; ext[3] - ext[2] + 1 &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; ext[5] - ext[4] + 1 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00730"></a>00730             &lt;&lt; <span class="stringliteral">&quot;# Number of bins output: &quot;</span> &lt;&lt; nbix &lt;&lt; <span class="stringliteral">&quot; x &quot;</span> &lt;&lt; nbiy &lt;&lt; <span class="stringliteral">&quot; x &quot;</span>
<a name="l00731"></a>00731             &lt;&lt; nbiz &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>
<a name="l00732"></a>00732             &lt;&lt; <span class="stringliteral">&quot;# Sample space extents: [&quot;</span> &lt;&lt; xmin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; xmax &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span>
<a name="l00733"></a>00733             &lt;&lt; ymin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; ymax &lt;&lt; <span class="stringliteral">&quot;], [&quot;</span> &lt;&lt; zmin &lt;&lt; <span class="stringliteral">&quot; : &quot;</span> &lt;&lt; zmax &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>
<a name="l00734"></a>00734             &lt;&lt; <span class="stringliteral">&quot;$EndComments\n&quot;</span>;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   <span class="comment">// Output mesh header: mesh version, file type, data size</span>
<a name="l00737"></a>00737   m_outFile &lt;&lt; <span class="stringliteral">&quot;$MeshFormat\n2.2 1 8\n&quot;</span>;
<a name="l00738"></a>00738   <span class="keywordtype">int</span> one = 1;
<a name="l00739"></a>00739   m_outFile.write( reinterpret_cast&lt;char*&gt;(&amp;one), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00740"></a>00740   m_outFile &lt;&lt; <span class="stringliteral">&quot;\n$EndMeshFormat\n&quot;</span>;
<a name="l00741"></a>00741   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   <span class="comment">// Output grid points of discretized sample space (3D Cartesian grid)</span>
<a name="l00744"></a>00744   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Nodes\n&quot;</span> &lt;&lt; (nbix+1)*(nbiy+1)*(nbiz+1) &lt;&lt; std::endl;
<a name="l00745"></a>00745   <span class="keywordtype">int</span> l=0;
<a name="l00746"></a>00746   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;=nbiz; k++) {
<a name="l00747"></a>00747     tk::real z = zmin + k*binsize[2];
<a name="l00748"></a>00748     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;=nbiy; j++) {
<a name="l00749"></a>00749       tk::real y = ymin + j*binsize[1];
<a name="l00750"></a>00750       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;=nbix; i++) {
<a name="l00751"></a>00751         tk::real x = xmin + i*binsize[0];
<a name="l00752"></a>00752         ++l;
<a name="l00753"></a>00753         m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;l ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00754"></a>00754         m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;x ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00755"></a>00755         m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;y ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00756"></a>00756         m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;z ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00757"></a>00757       }
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759   }
<a name="l00760"></a>00760   m_outFile &lt;&lt; <span class="stringliteral">&quot;\n$EndNodes\n&quot;</span>;
<a name="l00761"></a>00761 
<a name="l00762"></a>00762   <span class="comment">// Output elements of discretized sample space (3D Cartesian grid)</span>
<a name="l00763"></a>00763   m_outFile &lt;&lt; <span class="stringliteral">&quot;$Elements\n&quot;</span> &lt;&lt; nbix*nbiy*nbiz &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00764"></a>00764   <span class="keywordtype">int</span> type = 5;                       <span class="comment">// gmsh elem type: 8-node hexahedron</span>
<a name="l00765"></a>00765   std::size_t nelem = nbix*nbiy*nbiz; <span class="comment">// num of elements in (this single) block</span>
<a name="l00766"></a>00766   <span class="keywordtype">int</span> ntags = 2;                      <span class="comment">// number of element tags</span>
<a name="l00767"></a>00767   m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;type ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00768"></a>00768   m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;nelem ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00769"></a>00769   m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;ntags ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00770"></a>00770   <span class="keyword">const</span> <span class="keyword">auto</span> n = nbix*nbiy;
<a name="l00771"></a>00771   <span class="keyword">const</span> <span class="keyword">auto</span> p = (nbix+1)*(nbiy+1);
<a name="l00772"></a>00772   <span class="keywordflow">for</span> (std::size_t i=0; i&lt;nelem; ++i) {
<a name="l00773"></a>00773     <span class="keyword">const</span> <span class="keyword">auto</span> y = i/nbix + i/n*(nbix+1);
<a name="l00774"></a>00774     <span class="keyword">auto</span> <span class="keywordtype">id</span> = i+1;
<a name="l00775"></a>00775     <span class="keywordtype">int</span> tag[2] = { 1, 1 };
<a name="l00776"></a>00776     <span class="keywordtype">int</span> con[8] = { <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+1 ),
<a name="l00777"></a>00777                    static_cast&lt; int &gt;( i+y+2 ),
<a name="l00778"></a>00778                    <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+nbix+3 ),
<a name="l00779"></a>00779                    static_cast&lt; int &gt;( i+y+nbix+2 ),
<a name="l00780"></a>00780                    <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+p+1 ),
<a name="l00781"></a>00781                    static_cast&lt; int &gt;( i+y+p+2 ),
<a name="l00782"></a>00782                    <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+p+nbix+3 ),
<a name="l00783"></a>00783                    static_cast&lt; int &gt;( i+y+p+nbix+2 ) };
<a name="l00784"></a>00784     m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;<span class="keywordtype">id</span> ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00785"></a>00785     m_outFile.write( reinterpret_cast&lt; char* &gt;( tag ), 2*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00786"></a>00786     m_outFile.write( reinterpret_cast&lt; char* &gt;( con ), 8*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00787"></a>00787   }
<a name="l00788"></a>00788   m_outFile &lt;&lt; <span class="stringliteral">&quot;\n$EndElements\n&quot;</span>;
<a name="l00789"></a>00789 
<a name="l00790"></a>00790   <span class="comment">// Output PDF function values in element or node centers</span>
<a name="l00791"></a>00791   std::string c( <span class="stringliteral">&quot;Element&quot;</span> );
<a name="l00792"></a>00792   <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) {
<a name="l00793"></a>00793     ++nbix; ++nbiy; ++nbiz;
<a name="l00794"></a>00794     c = <span class="stringliteral">&quot;Node&quot;</span>;
<a name="l00795"></a>00795   }
<a name="l00796"></a>00796   m_outFile &lt;&lt; <span class="charliteral">&#39;$&#39;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;Data\n1\n\&quot;&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;\&quot;\n1\n0.0\n3\n0\n1\n&quot;</span>
<a name="l00797"></a>00797             &lt;&lt; nbix*nbiy*nbiz &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00798"></a>00798 
<a name="l00799"></a>00799   <span class="comment">// If no user-specified sample space extents, output pdf map directly</span>
<a name="l00800"></a>00800   <span class="keywordflow">if</span> (uext.empty()) {
<a name="l00801"></a>00801 
<a name="l00802"></a>00802     std::vector&lt; bool &gt; out( nbix*nbiy*nbiz, <span class="keyword">false</span> ); <span class="comment">// indicate bins filled</span>
<a name="l00803"></a>00803     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map()) {
<a name="l00804"></a>00804       <span class="keyword">const</span> <span class="keyword">auto</span> bin = (p.first[2] - ext[4]) * static_cast&lt;long&gt;(nbix*nbiy) +
<a name="l00805"></a>00805                        (p.first[1] - ext[2]) * static_cast&lt;long&gt;(nbix) +
<a name="l00806"></a>00806                        (p.first[0] - ext[0]) % static_cast&lt;long&gt;(nbix);
<a name="l00807"></a>00807       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &gt;= 0, <span class="stringliteral">&quot;Bin underflow in PDFWriter::writeGmshBin().&quot;</span> );
<a name="l00808"></a>00808       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &lt; nbix*nbiy*nbiz,
<a name="l00809"></a>00809               <span class="stringliteral">&quot;Bin overflow in PDFWriter::writeGmshBin().&quot;</span> );
<a name="l00810"></a>00810       out[ <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(bin) ] = <span class="keyword">true</span>;
<a name="l00811"></a>00811       <span class="keyword">auto</span> <span class="keywordtype">id</span> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(bin+1);
<a name="l00812"></a>00812       tk::real prob = p.second / binsize[0] / binsize[1] / binsize[2]
<a name="l00813"></a>00813                                / <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample());
<a name="l00814"></a>00814       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;<span class="keywordtype">id</span> ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00815"></a>00815       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;prob ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00816"></a>00816     }
<a name="l00817"></a>00817     <span class="comment">// Output bins nonexistent in PDF (gmsh sometimes fails to plot the exiting</span>
<a name="l00818"></a>00818     <span class="comment">// bins if holes exist in the data, it also looks better as zero than holes)</span>
<a name="l00819"></a>00819     tk::real prob = 0.0;
<a name="l00820"></a>00820     <span class="keywordflow">for</span> (std::size_t i=0; i&lt;out.size(); ++i)
<a name="l00821"></a>00821       <span class="keywordflow">if</span> (!out[i]) {
<a name="l00822"></a>00822         <span class="keyword">auto</span> <span class="keywordtype">id</span> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(i+1);
<a name="l00823"></a>00823         m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;<span class="keywordtype">id</span> ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00824"></a>00824         m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;prob ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00825"></a>00825       }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827   } <span class="keywordflow">else</span> { <span class="comment">// If user-specified sample space extents, output outpdf array</span>
<a name="l00828"></a>00828 
<a name="l00829"></a>00829     <span class="keywordtype">int</span> bin = 0;
<a name="l00830"></a>00830     <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p : outpdf) {
<a name="l00831"></a>00831       ++bin;
<a name="l00832"></a>00832       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;bin ), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) );
<a name="l00833"></a>00833       m_outFile.write( reinterpret_cast&lt; char* &gt;( &amp;p ), <span class="keyword">sizeof</span>(tk::real) );
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836   }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838   m_outFile &lt;&lt; <span class="stringliteral">&quot;$End&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;Data\n&quot;</span>;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( !m_outFile.bad(), <span class="stringliteral">&quot;Failed to write to file: &quot;</span> + m_filename );
<a name="l00841"></a>00841 }
<a name="l00842"></a>00842 
<a name="l00843"></a>00843 <span class="keywordtype">void</span>
<a name="l00844"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a6af1046645c630f1f169b9c99a82250e">00844</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a6af1046645c630f1f169b9c99a82250e" title="Write bivariate PDF to Exodus II file format.">PDFWriter::writeExodusII</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_bi_p_d_f.html" title="Joint bivariate PDF estimator.">BiPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>,
<a name="l00845"></a>00845                           <span class="keyword">const</span> <a class="code" href="structtk_1_1ctr_1_1_p_d_f_info.html" title="PDF information bundle.">tk::ctr::PDFInfo</a>&amp; info,
<a name="l00846"></a>00846                           std::size_t it,
<a name="l00847"></a>00847                           <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15">ctr::PDFCenteringType</a> centering ) <span class="keyword">const</span>
<a name="l00848"></a>00848 <span class="comment">//******************************************************************************</span>
<a name="l00849"></a>00849 <span class="comment">//  Write out standardized bivariate PDF to Exodus II format</span><span class="comment"></span>
<a name="l00850"></a>00850 <span class="comment">//! \param[in] pdf Bivariate PDF</span>
<a name="l00851"></a>00851 <span class="comment">//! \param[in] info PDF metadata</span>
<a name="l00852"></a>00852 <span class="comment">//! \param[in] it Iteration count</span>
<a name="l00853"></a>00853 <span class="comment">//! \param[in] centering Bin centering on sample space mesh</span>
<a name="l00854"></a>00854 <span class="comment">//! \author  J. Bakosi</span>
<a name="l00855"></a>00855 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00856"></a>00856 {
<a name="l00857"></a>00857   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; name = info.name;
<a name="l00858"></a>00858   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; uext = info.exts;
<a name="l00859"></a>00859   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> = info.vars;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861   assertSampleSpaceDimensions&lt; 2 &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> );
<a name="l00862"></a>00862   assertSampleSpaceExtents&lt; 2 &gt;( uext );
<a name="l00863"></a>00863 
<a name="l00864"></a>00864   <span class="comment">// Query and optionally override number of bins and minima of sample space if</span>
<a name="l00865"></a>00865   <span class="comment">// user-specified extents were given and copy probabilities from pdf to a</span>
<a name="l00866"></a>00866   <span class="comment">// logically 2D array for output</span>
<a name="l00867"></a>00867   std::size_t nbix, nbiy;
<a name="l00868"></a>00868   tk::real xmin, xmax, ymin, ymax;
<a name="l00869"></a>00869   std::vector&lt; tk::real &gt; outpdf;
<a name="l00870"></a>00870   std::array&lt; tk::real, 2 &gt; binsize;
<a name="l00871"></a>00871   std::array&lt; long, 2*BiPDF::dim &gt; ext;
<a name="l00872"></a>00872   extents( <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, uext, nbix, nbiy, xmin, xmax, ymin, ymax, binsize, ext, outpdf,
<a name="l00873"></a>00873            centering );
<a name="l00874"></a>00874 
<a name="l00875"></a>00875   <span class="comment">// Create ExodusII file</span>
<a name="l00876"></a>00876   <span class="keywordtype">int</span> outFile = createExFile();
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   <span class="comment">// Compute number of nodes and number of elements in sample space mesh</span>
<a name="l00879"></a>00879   std::size_t nelem = nbix*nbiy;
<a name="l00880"></a>00880   std::size_t nnode = (nbix+1)*(nbiy+1);
<a name="l00881"></a>00881 
<a name="l00882"></a>00882   <span class="comment">// Write ExodusII header</span>
<a name="l00883"></a>00883   writeExHdr( outFile, static_cast&lt;int&gt;(nnode), static_cast&lt;int&gt;(nelem) );
<a name="l00884"></a>00884 
<a name="l00885"></a>00885   <span class="comment">// Write sample space variables as coordinate names</span>
<a name="l00886"></a>00886   <span class="keywordtype">char</span>* coordnames[] = { <span class="keyword">const_cast&lt;</span> <span class="keywordtype">char</span>* <span class="keyword">&gt;</span>( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0].c_str() ),
<a name="l00887"></a>00887                          const_cast&lt; char* &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1].c_str() ),
<a name="l00888"></a>00888                          const_cast&lt; char* &gt;( <span class="stringliteral">&quot;probability&quot;</span> ) };
<a name="l00889"></a>00889   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_coord_names( outFile, coordnames ) == 0,
<a name="l00890"></a>00890           <span class="stringliteral">&quot;Failed to write coordinate names to file: &quot;</span> + m_filename );
<a name="l00891"></a>00891 
<a name="l00892"></a>00892   <span class="comment">// Output grid points of discretized sample space (2D Cartesian grid)</span>
<a name="l00893"></a>00893   std::vector&lt; tk::real &gt; x( nnode, 0.0 );
<a name="l00894"></a>00894   std::vector&lt; tk::real &gt; y( nnode, 0.0 );
<a name="l00895"></a>00895   std::vector&lt; tk::real &gt; z( nnode, 0.0 );
<a name="l00896"></a>00896   std::size_t k = 0;
<a name="l00897"></a>00897   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;=nbiy; i++)
<a name="l00898"></a>00898     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;=nbix; j++) {
<a name="l00899"></a>00899       x[k] = xmin + j*binsize[0];
<a name="l00900"></a>00900       y[k] = ymin + i*binsize[1];
<a name="l00901"></a>00901       ++k;
<a name="l00902"></a>00902     }
<a name="l00903"></a>00903   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_coord( outFile, x.data(), y.data(), z.data() ) == 0,
<a name="l00904"></a>00904           <span class="stringliteral">&quot;Failed to write coordinates to file: &quot;</span> + m_filename );
<a name="l00905"></a>00905 
<a name="l00906"></a>00906   <span class="comment">// Output elements of discretized sample space (2D Cartesian grid)</span>
<a name="l00907"></a>00907   <span class="comment">// Write element block information</span>
<a name="l00908"></a>00908   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_elem_block( outFile,
<a name="l00909"></a>00909                              1,
<a name="l00910"></a>00910                              <span class="stringliteral">&quot;QUADRANGLES&quot;</span>,
<a name="l00911"></a>00911                              static_cast&lt;int64_t&gt;(nelem),
<a name="l00912"></a>00912                              4,
<a name="l00913"></a>00913                              0 ) == 0,
<a name="l00914"></a>00914           <span class="stringliteral">&quot;Failed to write QUDARANGLE element block to file: &quot;</span> + m_filename );
<a name="l00915"></a>00915   <span class="comment">// Write element connectivity</span>
<a name="l00916"></a>00916   <span class="keywordflow">for</span> (std::size_t i=0; i&lt;nelem; ++i) {
<a name="l00917"></a>00917     <span class="keyword">auto</span> y = i/nbix;
<a name="l00918"></a>00918     <span class="keywordtype">int</span> con[4] = { <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+1 ),
<a name="l00919"></a>00919                    static_cast&lt; int &gt;( i+y+2 ),
<a name="l00920"></a>00920                    <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+nbix+3 ),
<a name="l00921"></a>00921                    static_cast&lt; int &gt;( i+y+nbix+2 ) };
<a name="l00922"></a>00922     <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>(
<a name="l00923"></a>00923       ne_put_n_elem_conn( outFile, 1, static_cast&lt;int64_t&gt;(i+1), 1, con ) == 0,
<a name="l00924"></a>00924       <span class="stringliteral">&quot;Failed to write element connectivity to file: &quot;</span> + m_filename );
<a name="l00925"></a>00925   }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927   <span class="comment">// Output PDF function values in element or node centers</span>
<a name="l00928"></a>00928   <span class="keywordtype">char</span> c = <span class="charliteral">&#39;e&#39;</span>;
<a name="l00929"></a>00929   <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) {
<a name="l00930"></a>00930     ++nbix; ++nbiy;
<a name="l00931"></a>00931     c = <span class="charliteral">&#39;n&#39;</span>;
<a name="l00932"></a>00932   }
<a name="l00933"></a>00933 
<a name="l00934"></a>00934   <span class="comment">// Write PDF function values metadata</span>
<a name="l00935"></a>00935   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_var_param( outFile, &amp;c, 1 ) == 0,
<a name="l00936"></a>00936             <span class="stringliteral">&quot;Failed to write results metadata to file: &quot;</span> + m_filename );
<a name="l00937"></a>00937   <span class="keywordtype">char</span>* probname[] = { <span class="keyword">const_cast&lt;</span> <span class="keywordtype">char</span>* <span class="keyword">&gt;</span>(
<a name="l00938"></a>00938                        (name + <span class="charliteral">&#39;(&#39;</span> + <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] + <span class="charliteral">&#39;,&#39;</span> + <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] + <span class="charliteral">&#39;)&#39;</span>).c_str() ) };
<a name="l00939"></a>00939   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_var_names( outFile, &amp;c, 1, probname ) == 0,
<a name="l00940"></a>00940             <span class="stringliteral">&quot;Failed to write results metadata to file: &quot;</span> + m_filename );
<a name="l00941"></a>00941 
<a name="l00942"></a>00942   <span class="comment">// If no user-specified sample space extents, output pdf map directly</span>
<a name="l00943"></a>00943   <span class="keywordflow">if</span> (uext.empty()) {
<a name="l00944"></a>00944 
<a name="l00945"></a>00945     <span class="comment">// Output PDF function values in element centers</span>
<a name="l00946"></a>00946     std::vector&lt; tk::real &gt; prob( nbix*nbiy, 0.0 );
<a name="l00947"></a>00947     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map()) {
<a name="l00948"></a>00948       <span class="keyword">const</span> <span class="keyword">auto</span> bin = (p.first[1] - ext[2]) * static_cast&lt;long&gt;(nbix) +
<a name="l00949"></a>00949                        (p.first[0] - ext[0]) % static_cast&lt;long&gt;(nbix);
<a name="l00950"></a>00950       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &gt;= 0, <span class="stringliteral">&quot;Bin underflow in PDFWriter::writeExodusII().&quot;</span> );
<a name="l00951"></a>00951       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &lt; nbix*nbiy, <span class="stringliteral">&quot;Bin overflow in PDFWriter::writeExodusII().&quot;</span> );
<a name="l00952"></a>00952       prob[ <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(bin) ] =
<a name="l00953"></a>00953         p.second / binsize[0] / binsize[1]
<a name="l00954"></a>00954                  / static_cast&lt;tk::real&gt;(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample());
<a name="l00955"></a>00955     }
<a name="l00956"></a>00956     writeExVar( outFile, it+1, centering, prob );
<a name="l00957"></a>00957 
<a name="l00958"></a>00958   } <span class="keywordflow">else</span> { <span class="comment">// If user-specified sample space extents, output outpdf array</span>
<a name="l00959"></a>00959 
<a name="l00960"></a>00960     writeExVar( outFile, it+1, centering, outpdf );
<a name="l00961"></a>00961 
<a name="l00962"></a>00962   }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_close(outFile) == 0, <span class="stringliteral">&quot;Failed to close file: &quot;</span> + m_filename );
<a name="l00965"></a>00965 }
<a name="l00966"></a>00966 
<a name="l00967"></a>00967 <span class="keywordtype">void</span>
<a name="l00968"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a0d07cbcd15d3a6d40c27cc5438e7af42">00968</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a6af1046645c630f1f169b9c99a82250e" title="Write bivariate PDF to Exodus II file format.">PDFWriter::writeExodusII</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_tri_p_d_f.html" title="Joint trivariate PDF estimator.">TriPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>,
<a name="l00969"></a>00969                           <span class="keyword">const</span> <a class="code" href="structtk_1_1ctr_1_1_p_d_f_info.html" title="PDF information bundle.">tk::ctr::PDFInfo</a>&amp; info,
<a name="l00970"></a>00970                           std::size_t it,
<a name="l00971"></a>00971                           <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15">ctr::PDFCenteringType</a> centering ) <span class="keyword">const</span>
<a name="l00972"></a>00972 <span class="comment">//******************************************************************************</span>
<a name="l00973"></a>00973 <span class="comment">//  Write out standardized trivariate PDF to Exodus II format</span><span class="comment"></span>
<a name="l00974"></a>00974 <span class="comment">//! \param[in] pdf Trivariate PDF</span>
<a name="l00975"></a>00975 <span class="comment">//! \param[in] info PDF metadata</span>
<a name="l00976"></a>00976 <span class="comment">//! \param[in] it Iteration count</span>
<a name="l00977"></a>00977 <span class="comment">//! \param[in] centering Bin centering on sample space mesh</span>
<a name="l00978"></a>00978 <span class="comment">//! \author  J. Bakosi</span>
<a name="l00979"></a>00979 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l00980"></a>00980 {
<a name="l00981"></a>00981   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; name = info.name;
<a name="l00982"></a>00982   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; uext = info.exts;
<a name="l00983"></a>00983   <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> = info.vars;
<a name="l00984"></a>00984 
<a name="l00985"></a>00985   assertSampleSpaceDimensions&lt; 3 &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a> );
<a name="l00986"></a>00986   assertSampleSpaceExtents&lt; 3 &gt;( uext );
<a name="l00987"></a>00987 
<a name="l00988"></a>00988   <span class="comment">// Query and optionally override number of bins and minima of sample space if</span>
<a name="l00989"></a>00989   <span class="comment">// user-specified extents were given and copy probabilities from pdf to a</span>
<a name="l00990"></a>00990   <span class="comment">// logically 3D array for output</span>
<a name="l00991"></a>00991   std::size_t nbix, nbiy, nbiz;
<a name="l00992"></a>00992   tk::real xmin, xmax, ymin, ymax, zmin, zmax;
<a name="l00993"></a>00993   std::vector&lt; tk::real &gt; outpdf;
<a name="l00994"></a>00994   std::array&lt; tk::real, 3 &gt; binsize;
<a name="l00995"></a>00995   std::array&lt; long, 2*TriPDF::dim &gt; ext;
<a name="l00996"></a>00996   extents( <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>, uext, nbix, nbiy, nbiz, xmin, xmax, ymin, ymax, zmin, zmax,
<a name="l00997"></a>00997            binsize, ext, outpdf, centering );
<a name="l00998"></a>00998 
<a name="l00999"></a>00999   <span class="comment">// Create ExodusII file</span>
<a name="l01000"></a>01000   <span class="keywordtype">int</span> outFile = createExFile();
<a name="l01001"></a>01001 
<a name="l01002"></a>01002   <span class="comment">// Compute number of nodes and number of elements in sample space mesh</span>
<a name="l01003"></a>01003   std::size_t nelem = nbix*nbiy*nbiz;
<a name="l01004"></a>01004   std::size_t nnode = (nbix+1)*(nbiy+1)*(nbiz+1);
<a name="l01005"></a>01005 
<a name="l01006"></a>01006   <span class="comment">// Write ExodusII header</span>
<a name="l01007"></a>01007   writeExHdr( outFile, static_cast&lt;int&gt;(nnode), static_cast&lt;int&gt;(nelem) );
<a name="l01008"></a>01008 
<a name="l01009"></a>01009   <span class="comment">// Write sample space variables as coordinate names</span>
<a name="l01010"></a>01010   <span class="keywordtype">char</span>* coordnames[] = { <span class="keyword">const_cast&lt;</span> <span class="keywordtype">char</span>* <span class="keyword">&gt;</span>( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0].c_str() ),
<a name="l01011"></a>01011                          const_cast&lt; char* &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1].c_str() ),
<a name="l01012"></a>01012                          const_cast&lt; char* &gt;( <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[2].c_str() ) };
<a name="l01013"></a>01013   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_coord_names( outFile, coordnames ) == 0,
<a name="l01014"></a>01014           <span class="stringliteral">&quot;Failed to write coordinate names to file: &quot;</span> + m_filename );
<a name="l01015"></a>01015 
<a name="l01016"></a>01016   <span class="comment">// Output grid points of discretized sample space (2D Cartesian grid)</span>
<a name="l01017"></a>01017   std::vector&lt; tk::real &gt; x( nnode, 0.0 );
<a name="l01018"></a>01018   std::vector&lt; tk::real &gt; y( nnode, 0.0 );
<a name="l01019"></a>01019   std::vector&lt; tk::real &gt; z( nnode, 0.0 );
<a name="l01020"></a>01020   std::size_t l=0;
<a name="l01021"></a>01021   <span class="keywordflow">for</span> (std::size_t k=0; k&lt;=nbiz; k++)
<a name="l01022"></a>01022     <span class="keywordflow">for</span> (std::size_t i=0; i&lt;=nbiy; i++)
<a name="l01023"></a>01023       <span class="keywordflow">for</span> (std::size_t j=0; j&lt;=nbix; j++) {
<a name="l01024"></a>01024         x[l] = xmin + <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(j) * binsize[0];
<a name="l01025"></a>01025         y[l] = ymin + <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(i) * binsize[1];
<a name="l01026"></a>01026         z[l] = zmin + <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(k) * binsize[2];
<a name="l01027"></a>01027         ++l;
<a name="l01028"></a>01028       }
<a name="l01029"></a>01029   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_coord( outFile, x.data(), y.data(), z.data() ) == 0,
<a name="l01030"></a>01030           <span class="stringliteral">&quot;Failed to write coordinates to file: &quot;</span> + m_filename );
<a name="l01031"></a>01031 
<a name="l01032"></a>01032   <span class="comment">// Output elements of discretized sample space (2D Cartesian grid)</span>
<a name="l01033"></a>01033   <span class="comment">// Write element block information</span>
<a name="l01034"></a>01034   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_elem_block( outFile,
<a name="l01035"></a>01035                              1,
<a name="l01036"></a>01036                              <span class="stringliteral">&quot;HEXAHEDRA&quot;</span>,
<a name="l01037"></a>01037                              static_cast&lt;int64_t&gt;(nelem),
<a name="l01038"></a>01038                              8,
<a name="l01039"></a>01039                              0 ) == 0,
<a name="l01040"></a>01040           <span class="stringliteral">&quot;Failed to write HEXAHEDRA element block to file: &quot;</span> + m_filename );
<a name="l01041"></a>01041   <span class="comment">// Write element connectivity</span>
<a name="l01042"></a>01042   <span class="keyword">const</span> <span class="keyword">auto</span> n = nbix*nbiy;
<a name="l01043"></a>01043   <span class="keyword">const</span> <span class="keyword">auto</span> p = (nbix+1)*(nbiy+1);
<a name="l01044"></a>01044   <span class="keywordflow">for</span> (std::size_t i=0; i&lt;nelem; ++i) {
<a name="l01045"></a>01045     <span class="keyword">const</span> <span class="keyword">auto</span> y = i/nbix + i/n*(nbix+1);
<a name="l01046"></a>01046     <span class="keywordtype">int</span> con[8] = { <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+1 ),
<a name="l01047"></a>01047                    static_cast&lt; int &gt;( i+y+2 ),
<a name="l01048"></a>01048                    <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+nbix+3 ),
<a name="l01049"></a>01049                    static_cast&lt; int &gt;( i+y+nbix+2 ),
<a name="l01050"></a>01050                    <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+p+1 ),
<a name="l01051"></a>01051                    static_cast&lt; int &gt;( i+y+p+2 ),
<a name="l01052"></a>01052                    <span class="keyword">static_cast&lt;</span> <span class="keywordtype">int</span> <span class="keyword">&gt;</span>( i+y+p+nbix+3 ),
<a name="l01053"></a>01053                    static_cast&lt; int &gt;( i+y+p+nbix+2 ) };
<a name="l01054"></a>01054     <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>(
<a name="l01055"></a>01055       ne_put_n_elem_conn( outFile, 1, static_cast&lt;int64_t&gt;(i+1), 1, con ) == 0,
<a name="l01056"></a>01056       <span class="stringliteral">&quot;Failed to write element connectivity to file: &quot;</span> + m_filename );
<a name="l01057"></a>01057   }
<a name="l01058"></a>01058 
<a name="l01059"></a>01059   <span class="comment">// Output PDF function values in element or node centers</span>
<a name="l01060"></a>01060   <span class="keywordtype">char</span> c = <span class="charliteral">&#39;e&#39;</span>;
<a name="l01061"></a>01061   <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) {
<a name="l01062"></a>01062     ++nbix; ++nbiy; ++nbiz;
<a name="l01063"></a>01063     c = <span class="charliteral">&#39;n&#39;</span>;
<a name="l01064"></a>01064   }
<a name="l01065"></a>01065 
<a name="l01066"></a>01066   <span class="comment">// Write PDF function values metadata</span>
<a name="l01067"></a>01067   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_var_param( outFile, &amp;c, 1 ) == 0,
<a name="l01068"></a>01068             <span class="stringliteral">&quot;Failed to write results metadata to file: &quot;</span> + m_filename );
<a name="l01069"></a>01069   <span class="keywordtype">char</span>* probname[] = { <span class="keyword">const_cast&lt;</span> <span class="keywordtype">char</span>* <span class="keyword">&gt;</span>( (name + <span class="charliteral">&#39;(&#39;</span> + <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[0] + <span class="charliteral">&#39;,&#39;</span> +
<a name="l01070"></a>01070                          <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[1] + <span class="charliteral">&#39;,&#39;</span> + <a class="code" href="namespacetk_1_1ctr.html#aec7b1fae00e22c12dfa1112fb6c4324c" title="Find sample space variables for a PDF.">vars</a>[2] + <span class="charliteral">&#39;)&#39;</span>).c_str() ) };
<a name="l01071"></a>01071   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_var_names( outFile, &amp;c, 1, probname ) == 0,
<a name="l01072"></a>01072             <span class="stringliteral">&quot;Failed to write results metadata to file: &quot;</span> + m_filename );
<a name="l01073"></a>01073 
<a name="l01074"></a>01074   <span class="comment">// If no user-specified sample space extents, output pdf map directly</span>
<a name="l01075"></a>01075   <span class="keywordflow">if</span> (uext.empty()) {
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <span class="comment">// Output PDF function values in element centers</span>
<a name="l01078"></a>01078     std::vector&lt; tk::real &gt; prob( nbix*nbiy*nbiz, 0.0 );
<a name="l01079"></a>01079     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map()) {
<a name="l01080"></a>01080       <span class="keyword">const</span> <span class="keyword">auto</span> bin = (p.first[2] - ext[4]) * static_cast&lt;long&gt;(nbix*nbiy) +
<a name="l01081"></a>01081                        (p.first[1] - ext[2]) * static_cast&lt;long&gt;(nbix) +
<a name="l01082"></a>01082                        (p.first[0] - ext[0]) % static_cast&lt;long&gt;(nbix);
<a name="l01083"></a>01083       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &gt;= 0, <span class="stringliteral">&quot;Bin underflow in PDFWriter::writeExodusII().&quot;</span> );
<a name="l01084"></a>01084       <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &lt; nbix*nbiy*nbiz,
<a name="l01085"></a>01085               <span class="stringliteral">&quot;Bin overflow in PDFWriter::writeExodusII().&quot;</span> );
<a name="l01086"></a>01086       prob[ <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(bin) ] =
<a name="l01087"></a>01087         p.second / binsize[0] / binsize[1] / binsize[2]
<a name="l01088"></a>01088                  / static_cast&lt;tk::real&gt;(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample());
<a name="l01089"></a>01089     }
<a name="l01090"></a>01090     writeExVar( outFile, it+1, centering, prob );
<a name="l01091"></a>01091 
<a name="l01092"></a>01092   } <span class="keywordflow">else</span> { <span class="comment">// If user-specified sample space extents, output outpdf array</span>
<a name="l01093"></a>01093 
<a name="l01094"></a>01094     writeExVar( outFile, it+1, centering, outpdf );
<a name="l01095"></a>01095 
<a name="l01096"></a>01096   }
<a name="l01097"></a>01097 
<a name="l01098"></a>01098   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_close(outFile) == 0, <span class="stringliteral">&quot;Failed to close file: &quot;</span> + m_filename );
<a name="l01099"></a>01099 }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 <span class="keywordtype">int</span>
<a name="l01102"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a7743163b6192e4767627137ba2463fe7">01102</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a7743163b6192e4767627137ba2463fe7">PDFWriter::createExFile</a>() const
<a name="l01103"></a>01103 <span class="comment">//******************************************************************************</span>
<a name="l01104"></a>01104 <span class="comment">//  Create Exodus II file</span><span class="comment"></span>
<a name="l01105"></a>01105 <span class="comment">//! \return ExodusII file handle</span>
<a name="l01106"></a>01106 <span class="comment">//! \author J. Bakosi</span>
<a name="l01107"></a>01107 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l01108"></a>01108 {
<a name="l01109"></a>01109   <span class="keywordtype">int</span> cpuwordsize = <span class="keyword">sizeof</span>( double );
<a name="l01110"></a>01110   <span class="keywordtype">int</span> iowordsize = <span class="keyword">sizeof</span>( double );
<a name="l01111"></a>01111   <span class="keywordtype">int</span> outFileId = ex_create( <a class="code" href="classtk_1_1_writer.html#a7a3f5175d78fff6d537d82c8a0a37f0e" title="File name.">m_filename</a>.c_str(),
<a name="l01112"></a>01112                              EX_CLOBBER | EX_NORMAL_MODEL,
<a name="l01113"></a>01113                              &amp;cpuwordsize,
<a name="l01114"></a>01114                              &amp;iowordsize );
<a name="l01115"></a>01115   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( outFileId &gt; 0, <span class="stringliteral">&quot;Failed to create file: &quot;</span> + <a class="code" href="classtk_1_1_writer.html#a7a3f5175d78fff6d537d82c8a0a37f0e" title="File name.">m_filename</a> );
<a name="l01116"></a>01116   <span class="keywordflow">return</span> outFileId;
<a name="l01117"></a>01117 }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="keywordtype">void</span>
<a name="l01120"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a30df2472b4cb140d9231bbbb28a0679e">01120</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a30df2472b4cb140d9231bbbb28a0679e">PDFWriter::writeExHdr</a>( <span class="keywordtype">int</span> outFileId, <span class="keywordtype">int</span> nnode, <span class="keywordtype">int</span> nelem ) <span class="keyword">const</span>
<a name="l01121"></a>01121 <span class="comment">//******************************************************************************</span>
<a name="l01122"></a>01122 <span class="comment">//  Write Exodus II file header</span><span class="comment"></span>
<a name="l01123"></a>01123 <span class="comment">//! \param[in] outFileId Output file ExodusII Id</span>
<a name="l01124"></a>01124 <span class="comment">//! \param[in] nnode Number of nodes in mesh to write</span>
<a name="l01125"></a>01125 <span class="comment">//! \param[in] nelem Number of elements in mesh to write</span>
<a name="l01126"></a>01126 <span class="comment">//! \author J. Bakosi</span>
<a name="l01127"></a>01127 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l01128"></a>01128 {
<a name="l01129"></a>01129   <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_init( outFileId,
<a name="l01130"></a>01130                        <span class="stringliteral">&quot;Written by Quinoa&quot;</span>,
<a name="l01131"></a>01131                        3,                     <span class="comment">// number of dimensions</span>
<a name="l01132"></a>01132                        nnode,                 <span class="comment">// number of nodes</span>
<a name="l01133"></a>01133                        nelem,                 <span class="comment">// number of elements</span>
<a name="l01134"></a>01134                        1,                     <span class="comment">// number of element blocks</span>
<a name="l01135"></a>01135                        0,                     <span class="comment">// number of node sets</span>
<a name="l01136"></a>01136                        0 ) == 0,              <span class="comment">// number of side sets</span>
<a name="l01137"></a>01137           <span class="stringliteral">&quot;Failed to write header to file: &quot;</span> + m_filename );
<a name="l01138"></a>01138 }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140 <span class="keywordtype">void</span>
<a name="l01141"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a7be8c9494b06b799f81b0a249567da3f">01141</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a7be8c9494b06b799f81b0a249567da3f">PDFWriter::writeExVar</a>( <span class="keywordtype">int</span> exoFile,
<a name="l01142"></a>01142                        std::size_t it,
<a name="l01143"></a>01143                        <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15">ctr::PDFCenteringType</a> centering,
<a name="l01144"></a>01144                        <span class="keyword">const</span> std::vector&lt; tk::real &gt;&amp; probability ) <span class="keyword">const</span>
<a name="l01145"></a>01145 <span class="comment">//******************************************************************************</span>
<a name="l01146"></a>01146 <span class="comment">//  Output probability density function as Exodus II results field</span><span class="comment"></span>
<a name="l01147"></a>01147 <span class="comment">//! \param[in] exoFile ExodusII file handle to write to</span>
<a name="l01148"></a>01148 <span class="comment">//! \param[in] it Iteration count</span>
<a name="l01149"></a>01149 <span class="comment">//! \param[in] centering Node-, or element-centering to use on sample space mesh</span>
<a name="l01150"></a>01150 <span class="comment">//! \param[in] probability Probabilities at each sample space location</span>
<a name="l01151"></a>01151 <span class="comment">//! \author J. Bakosi</span>
<a name="l01152"></a>01152 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l01153"></a>01153 {
<a name="l01154"></a>01154   <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>)
<a name="l01155"></a>01155     <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_nodal_var( exoFile,
<a name="l01156"></a>01156                               1,
<a name="l01157"></a>01157                               1,
<a name="l01158"></a>01158                               static_cast&lt;int64_t&gt;(probability.size()),
<a name="l01159"></a>01159                               probability.data() ) == 0,
<a name="l01160"></a>01160             <span class="stringliteral">&quot;Failed to write node-centered bivariate PDF to file: &quot;</span> +
<a name="l01161"></a>01161             m_filename );
<a name="l01162"></a>01162   <span class="keywordflow">else</span>
<a name="l01163"></a>01163     <a class="code" href="_exception_8h.html#ac75cd6578896829d2bfbccf5de71de4f" title="ErrChk macro that only throws an exception if expr fails.">ErrChk</a>( ex_put_elem_var( exoFile,
<a name="l01164"></a>01164                              1,
<a name="l01165"></a>01165                              1,
<a name="l01166"></a>01166                              1,
<a name="l01167"></a>01167                              static_cast&lt;int64_t&gt;(probability.size()),
<a name="l01168"></a>01168                              probability.data() ) == 0,
<a name="l01169"></a>01169             <span class="stringliteral">&quot;Failed to write elem-centered bivariate PDF to file: &quot;</span> +
<a name="l01170"></a>01170             m_filename );
<a name="l01171"></a>01171 }
<a name="l01172"></a>01172 
<a name="l01173"></a>01173 <span class="keywordtype">void</span>
<a name="l01174"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a58e74d6f045704bd1f9c6698e6a779ae">01174</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a58e74d6f045704bd1f9c6698e6a779ae" title="Query extents and other metadata of univariate PDF sample space.">PDFWriter::extents</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_uni_p_d_f.html" title="Univariate PDF estimator.">UniPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>,
<a name="l01175"></a>01175                     <span class="keyword">const</span> std::vector&lt; tk::real &gt;&amp; uext,
<a name="l01176"></a>01176                     std::size_t&amp; nbi,
<a name="l01177"></a>01177                     tk::real&amp; min,
<a name="l01178"></a>01178                     tk::real&amp; max,
<a name="l01179"></a>01179                     tk::real&amp; binsize,
<a name="l01180"></a>01180                     std::array&lt; long, 2*UniPDF::dim &gt;&amp; ext,
<a name="l01181"></a>01181                     std::vector&lt; tk::real &gt;&amp; outpdf ) <span class="keyword">const</span>
<a name="l01182"></a>01182 <span class="comment">//******************************************************************************</span>
<a name="l01183"></a>01183 <span class="comment">//  Query extents and other metadata of univariate PDF sample space</span><span class="comment"></span>
<a name="l01184"></a>01184 <span class="comment">//! \details Query and optionally override number of bins and minimum of sample</span>
<a name="l01185"></a>01185 <span class="comment">//!    space if user-specified extents were given and copy probabilities from</span>
<a name="l01186"></a>01186 <span class="comment">//!    pdf to an array for output for plotting univariate PDF.</span>
<a name="l01187"></a>01187 <span class="comment">//! \param[in] pdf Univariate PDF object</span>
<a name="l01188"></a>01188 <span class="comment">//! \param[in] uext User-specified extents of sample space</span>
<a name="l01189"></a>01189 <span class="comment">//! \param[inout] nbi Number of bins</span>
<a name="l01190"></a>01190 <span class="comment">//! \param[inout] min Minimum value of sample space</span>
<a name="l01191"></a>01191 <span class="comment">//! \param[inout] max Maximum value of sample space</span>
<a name="l01192"></a>01192 <span class="comment">//! \param[inout] binsize Bin size</span>
<a name="l01193"></a>01193 <span class="comment">//! \param[inout] ext Extents of sample space</span>
<a name="l01194"></a>01194 <span class="comment">//! \param[inout] outpdf PDF ready to be written out to file</span>
<a name="l01195"></a>01195 <span class="comment">//! \author J. Bakosi</span>
<a name="l01196"></a>01196 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l01197"></a>01197 {
<a name="l01198"></a>01198   assertSampleSpaceExtents&lt; 1 &gt;( uext );
<a name="l01199"></a>01199 
<a name="l01200"></a>01200   <span class="comment">// Query bin size and extents of sample space from PDF</span>
<a name="l01201"></a>01201   binsize = <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.binsize();
<a name="l01202"></a>01202   ext = <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.extents();
<a name="l01203"></a>01203 
<a name="l01204"></a>01204   <span class="comment">// Compute number of bins of sample space (min bins: 1)</span>
<a name="l01205"></a>01205   <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( ext[1] &gt;= ext[0], <span class="stringliteral">&quot;Wrong extents in PDFWriter::extents&quot;</span> );
<a name="l01206"></a>01206   nbi = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>( ext[1] - ext[0] + 1 );
<a name="l01207"></a>01207 
<a name="l01208"></a>01208   <span class="comment">// Compute minimum and maximum of sample space</span>
<a name="l01209"></a>01209   min = binsize * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[0] );
<a name="l01210"></a>01210   max = binsize * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[1] );
<a name="l01211"></a>01211 
<a name="l01212"></a>01212   <span class="comment">// Override number of bins and minimum if user-specified extents were given,</span>
<a name="l01213"></a>01213   <span class="comment">// and copy probabilities from pdf to an array for output</span>
<a name="l01214"></a>01214   <span class="keywordflow">if</span> (!uext.empty()) {
<a name="l01215"></a>01215     <span class="comment">// Override number of bins by that based on user-specified extents</span>
<a name="l01216"></a>01216     <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( uext[1] &gt;= uext[0],
<a name="l01217"></a>01217             <span class="stringliteral">&quot;Wrong user-defined extents in PDFWriter::extents&quot;</span> );
<a name="l01218"></a>01218     nbi = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>(
<a name="l01219"></a>01219             std::lround( (uext[1] - uext[0]) / binsize ) );
<a name="l01220"></a>01220     <span class="comment">// Override extents</span>
<a name="l01221"></a>01221     min = uext[0];
<a name="l01222"></a>01222     max = uext[1];
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     <span class="comment">// Size output pdf to user-requested dimensions to overridden nbi and</span>
<a name="l01225"></a>01225     <span class="comment">// initialize output probabilities to zero</span>
<a name="l01226"></a>01226     outpdf = std::vector&lt; tk::real &gt;( nbi, 0.0 );
<a name="l01227"></a>01227 
<a name="l01228"></a>01228     <span class="comment">// Fill requested region of pdf to be output from computed pdf</span>
<a name="l01229"></a>01229     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map()) {
<a name="l01230"></a>01230       <span class="comment">// Compute (i.e., shift) bin indices relative to user-requested extents</span>
<a name="l01231"></a>01231       <span class="keyword">const</span> <span class="keyword">auto</span> bin = p.first - std::lround( uext[0] / binsize );
<a name="l01232"></a>01232       <span class="comment">// Only copy probability value if shifted bin indices fall within</span>
<a name="l01233"></a>01233       <span class="comment">// user-requested extents (lower inclusive, upper exclusive)</span>
<a name="l01234"></a>01234       <span class="keywordflow">if</span> (bin &gt;= 0 &amp;&amp; bin &lt; std::lround( (uext[1] - uext[0]) / binsize )) {
<a name="l01235"></a>01235         <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &lt; nbi, <span class="stringliteral">&quot;Bin overflow in user-specified-extent-based bin &quot;</span>
<a name="l01236"></a>01236                            <span class="stringliteral">&quot;calculation of univariate PDF extents.&quot;</span> );
<a name="l01237"></a>01237         <span class="comment">// Copy normalized probability to output pdf</span>
<a name="l01238"></a>01238         outpdf[ <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(bin) ] =
<a name="l01239"></a>01239           p.second / binsize / static_cast&lt;tk::real&gt;(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample());
<a name="l01240"></a>01240       }
<a name="l01241"></a>01241     }
<a name="l01242"></a>01242   }
<a name="l01243"></a>01243 }
<a name="l01244"></a>01244 
<a name="l01245"></a>01245 <span class="keywordtype">void</span>
<a name="l01246"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#a61a0c52d1e78abd4c5c11fee96577183">01246</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a58e74d6f045704bd1f9c6698e6a779ae" title="Query extents and other metadata of univariate PDF sample space.">PDFWriter::extents</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_bi_p_d_f.html" title="Joint bivariate PDF estimator.">BiPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>,
<a name="l01247"></a>01247                     <span class="keyword">const</span> std::vector&lt; tk::real &gt;&amp; uext,
<a name="l01248"></a>01248                     std::size_t&amp; nbix,
<a name="l01249"></a>01249                     std::size_t&amp; nbiy,
<a name="l01250"></a>01250                     tk::real&amp; xmin,
<a name="l01251"></a>01251                     tk::real&amp; xmax,
<a name="l01252"></a>01252                     tk::real&amp; ymin,
<a name="l01253"></a>01253                     tk::real&amp; ymax,
<a name="l01254"></a>01254                     std::array&lt; tk::real, BiPDF::dim &gt;&amp; binsize,
<a name="l01255"></a>01255                     std::array&lt; long, 2*BiPDF::dim &gt;&amp; ext,
<a name="l01256"></a>01256                     std::vector&lt; tk::real &gt;&amp; outpdf,
<a name="l01257"></a>01257                     <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15">ctr::PDFCenteringType</a> centering ) <span class="keyword">const</span>
<a name="l01258"></a>01258 <span class="comment">//******************************************************************************</span>
<a name="l01259"></a>01259 <span class="comment">//  Query extents and other metadata of bivariate PDF sample space</span><span class="comment"></span>
<a name="l01260"></a>01260 <span class="comment">//! \details Query and optionally override number of bins and minima of sample</span>
<a name="l01261"></a>01261 <span class="comment">//!    space if user-specified extents were given and copy probabilities from</span>
<a name="l01262"></a>01262 <span class="comment">//!    pdf to a logically 2D array for output for plotting bivariate joint PDF.</span>
<a name="l01263"></a>01263 <span class="comment">//! \param[in] pdf Bivariate PDF object</span>
<a name="l01264"></a>01264 <span class="comment">//! \param[in] uext User-specified extents of sample space</span>
<a name="l01265"></a>01265 <span class="comment">//! \param[inout] nbix Number of bins in x dimension</span>
<a name="l01266"></a>01266 <span class="comment">//! \param[inout] nbiy Number of bins in y dimension</span>
<a name="l01267"></a>01267 <span class="comment">//! \param[inout] xmin Minimum x value of sample space</span>
<a name="l01268"></a>01268 <span class="comment">//! \param[inout] xmax Maximum x value of sample space</span>
<a name="l01269"></a>01269 <span class="comment">//! \param[inout] ymin Minimum y value of sample space</span>
<a name="l01270"></a>01270 <span class="comment">//! \param[inout] ymax Maximum y value of sample space</span>
<a name="l01271"></a>01271 <span class="comment">//! \param[inout] binsize Bin size</span>
<a name="l01272"></a>01272 <span class="comment">//! \param[inout] ext Extents of sample space</span>
<a name="l01273"></a>01273 <span class="comment">//! \param[inout] outpdf PDF ready to be written out to file</span>
<a name="l01274"></a>01274 <span class="comment">//! \param[in] centering Bin centering on sample space mesh</span>
<a name="l01275"></a>01275 <span class="comment">//! \author J. Bakosi</span>
<a name="l01276"></a>01276 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l01277"></a>01277 {
<a name="l01278"></a>01278   assertSampleSpaceExtents&lt; 2 &gt;( uext );
<a name="l01279"></a>01279 
<a name="l01280"></a>01280   <span class="comment">// Query bin sizes and extents of sample space from PDF</span>
<a name="l01281"></a>01281   binsize = <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.binsize();
<a name="l01282"></a>01282   ext = <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.extents();
<a name="l01283"></a>01283 
<a name="l01284"></a>01284   <span class="comment">// Compute number of bins in sample space directions (min bins: 1)</span>
<a name="l01285"></a>01285   <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( ext[1] &gt;= ext[0], <span class="stringliteral">&quot;Wrong extents in PDFWriter::extents&quot;</span> );
<a name="l01286"></a>01286   <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( ext[3] &gt;= ext[2], <span class="stringliteral">&quot;Wrong extents in PDFWriter::extents&quot;</span> );
<a name="l01287"></a>01287   nbix = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>( ext[1] - ext[0] + 1 );
<a name="l01288"></a>01288   nbiy = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>( ext[3] - ext[2] + 1 );
<a name="l01289"></a>01289 
<a name="l01290"></a>01290   <span class="comment">// Compute minima and maxima of sample space</span>
<a name="l01291"></a>01291   xmin = binsize[0] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[0] );
<a name="l01292"></a>01292   xmax = binsize[0] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[1] );
<a name="l01293"></a>01293   ymin = binsize[1] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[2] );
<a name="l01294"></a>01294   ymax = binsize[1] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[3] );
<a name="l01295"></a>01295 
<a name="l01296"></a>01296   <span class="comment">// Override number of bins and minima if user-specified extents were given,</span>
<a name="l01297"></a>01297   <span class="comment">// and copy probabilities from pdf to a logically 2D array for output</span>
<a name="l01298"></a>01298   <span class="keywordflow">if</span> (!uext.empty()) {
<a name="l01299"></a>01299     <span class="comment">// Override number of bins by that based on user-specified extents</span>
<a name="l01300"></a>01300     <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( uext[1] &gt;= uext[0],
<a name="l01301"></a>01301             <span class="stringliteral">&quot;Wrong user-defined extents in PDFWriter::extents&quot;</span> );
<a name="l01302"></a>01302     <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( uext[3] &gt;= uext[2],
<a name="l01303"></a>01303             <span class="stringliteral">&quot;Wrong user-defined extents in PDFWriter::extents&quot;</span> );
<a name="l01304"></a>01304     nbix = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>(
<a name="l01305"></a>01305              std::lround( (uext[1] - uext[0]) / binsize[0] ) );
<a name="l01306"></a>01306     nbiy = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>(
<a name="l01307"></a>01307              std::lround( (uext[3] - uext[2]) / binsize[1] ) );
<a name="l01308"></a>01308     <span class="comment">// Override extents</span>
<a name="l01309"></a>01309     xmin = uext[0];
<a name="l01310"></a>01310     xmax = uext[1];
<a name="l01311"></a>01311     ymin = uext[2];
<a name="l01312"></a>01312     ymax = uext[3];
<a name="l01313"></a>01313 
<a name="l01314"></a>01314     <span class="comment">// Temporarily increase number of bins if node-centered output required</span>
<a name="l01315"></a>01315     <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) { ++nbix; ++nbiy; }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317     <span class="comment">// Size output pdf to user-requested dimensions to overridden nbiy * nbix</span>
<a name="l01318"></a>01318     <span class="comment">// and initialize output probabilities to zero</span>
<a name="l01319"></a>01319     outpdf = std::vector&lt; tk::real &gt;( nbix*nbiy, 0.0 );
<a name="l01320"></a>01320 
<a name="l01321"></a>01321     <span class="comment">// Fill requested region of pdf to be output from computed pdf</span>
<a name="l01322"></a>01322     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map()) {
<a name="l01323"></a>01323       <span class="comment">// Compute (i.e., shift) bin indices relative to user-requested extents</span>
<a name="l01324"></a>01324       <span class="keyword">const</span> <span class="keyword">auto</span> x = p.first[0] - std::lround( uext[0] / binsize[0] );
<a name="l01325"></a>01325       <span class="keyword">const</span> <span class="keyword">auto</span> y = p.first[1] - std::lround( uext[2] / binsize[1] );
<a name="l01326"></a>01326       <span class="comment">// Only copy probability value if shifted bin indices fall within</span>
<a name="l01327"></a>01327       <span class="comment">// user-requested extents (lower inclusive, upper exclusive)</span>
<a name="l01328"></a>01328       <span class="keywordflow">if</span> (x &gt;= 0 &amp;&amp; x &lt; std::lround( (uext[1] - uext[0]) / binsize[0] ) &amp;&amp;
<a name="l01329"></a>01329           y &gt;= 0 &amp;&amp; y &lt; std::lround( (uext[3] - uext[2]) / binsize[1] ))
<a name="l01330"></a>01330       {
<a name="l01331"></a>01331         <span class="keyword">const</span> <span class="keyword">auto</span> bin =
<a name="l01332"></a>01332           <span class="keyword">static_cast&lt;</span>std::size_t<span class="keyword">&gt;</span>(y)*nbix + static_cast&lt;std::size_t&gt;(x);
<a name="l01333"></a>01333         <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &lt; nbix*nbiy, <span class="stringliteral">&quot;Bin overflow in user-specified-extent-based &quot;</span>
<a name="l01334"></a>01334                 <span class="stringliteral">&quot;bin calculation of bivariate PDF.&quot;</span> );
<a name="l01335"></a>01335         <span class="comment">// Copy normalized probability to output pdf</span>
<a name="l01336"></a>01336         outpdf[ bin ] = p.second / binsize[0] / binsize[1]
<a name="l01337"></a>01337                                  / <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample());
<a name="l01338"></a>01338       }
<a name="l01339"></a>01339     }
<a name="l01340"></a>01340 
<a name="l01341"></a>01341     <span class="comment">// Revert number of bins if node-centered output required</span>
<a name="l01342"></a>01342     <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) { --nbix; --nbiy; }
<a name="l01343"></a>01343   }
<a name="l01344"></a>01344 }
<a name="l01345"></a>01345 
<a name="l01346"></a>01346 <span class="keywordtype">void</span>
<a name="l01347"></a><a class="code" href="classtk_1_1_p_d_f_writer.html#acb06a2b99c44a13e0c92c4843ea95eed">01347</a> <a class="code" href="classtk_1_1_p_d_f_writer.html#a58e74d6f045704bd1f9c6698e6a779ae" title="Query extents and other metadata of univariate PDF sample space.">PDFWriter::extents</a>( <span class="keyword">const</span> <a class="code" href="classtk_1_1_tri_p_d_f.html" title="Joint trivariate PDF estimator.">TriPDF</a>&amp; <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>,
<a name="l01348"></a>01348                     <span class="keyword">const</span> std::vector&lt; tk::real &gt;&amp; uext,
<a name="l01349"></a>01349                     std::size_t&amp; nbix,
<a name="l01350"></a>01350                     std::size_t&amp; nbiy,
<a name="l01351"></a>01351                     std::size_t&amp; nbiz,
<a name="l01352"></a>01352                     tk::real&amp; xmin,
<a name="l01353"></a>01353                     tk::real&amp; xmax,
<a name="l01354"></a>01354                     tk::real&amp; ymin,
<a name="l01355"></a>01355                     tk::real&amp; ymax,
<a name="l01356"></a>01356                     tk::real&amp; zmin,
<a name="l01357"></a>01357                     tk::real&amp; zmax,
<a name="l01358"></a>01358                     std::array&lt; tk::real, TriPDF::dim &gt;&amp; binsize,
<a name="l01359"></a>01359                     std::array&lt; long, 2*TriPDF::dim &gt;&amp; ext,
<a name="l01360"></a>01360                     std::vector&lt; tk::real &gt;&amp; outpdf,
<a name="l01361"></a>01361                     <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15">ctr::PDFCenteringType</a> centering ) <span class="keyword">const</span>
<a name="l01362"></a>01362 <span class="comment">//******************************************************************************</span>
<a name="l01363"></a>01363 <span class="comment">//  Query extents and other metadata of trivariate PDF sample space</span><span class="comment"></span>
<a name="l01364"></a>01364 <span class="comment">//! \details Query and optionally override number of bins and minima of sample</span>
<a name="l01365"></a>01365 <span class="comment">//!   space if user-specified extents were given and copy probabilities from</span>
<a name="l01366"></a>01366 <span class="comment">//!   pdf to a logically 3D array for output for plotting trivariate joint PDF.</span>
<a name="l01367"></a>01367 <span class="comment">//! \param[in] pdf Trivariate PDF object</span>
<a name="l01368"></a>01368 <span class="comment">//! \param[in] uext User-specified extents of sample space</span>
<a name="l01369"></a>01369 <span class="comment">//! \param[inout] nbix Number of bins in x dimension</span>
<a name="l01370"></a>01370 <span class="comment">//! \param[inout] nbiy Number of bins in y dimension</span>
<a name="l01371"></a>01371 <span class="comment">//! \param[inout] nbiz Number of bins in z dimension</span>
<a name="l01372"></a>01372 <span class="comment">//! \param[inout] xmin Minimum x value of sample space</span>
<a name="l01373"></a>01373 <span class="comment">//! \param[inout] xmax Maximum x value of sample space</span>
<a name="l01374"></a>01374 <span class="comment">//! \param[inout] ymin Minimum y value of sample space</span>
<a name="l01375"></a>01375 <span class="comment">//! \param[inout] ymax Maximum y value of sample space</span>
<a name="l01376"></a>01376 <span class="comment">//! \param[inout] zmin Minimum z value of sample space</span>
<a name="l01377"></a>01377 <span class="comment">//! \param[inout] zmax Maximum z value of sample space</span>
<a name="l01378"></a>01378 <span class="comment">//! \param[inout] binsize Bin size</span>
<a name="l01379"></a>01379 <span class="comment">//! \param[inout] ext Extents of sample space</span>
<a name="l01380"></a>01380 <span class="comment">//! \param[inout] outpdf PDF ready to be written out to file</span>
<a name="l01381"></a>01381 <span class="comment">//! \param[in] centering Bin centering on sample space mesh</span>
<a name="l01382"></a>01382 <span class="comment">//! \author J. Bakosi</span>
<a name="l01383"></a>01383 <span class="comment"></span><span class="comment">//******************************************************************************</span>
<a name="l01384"></a>01384 {
<a name="l01385"></a>01385   assertSampleSpaceExtents&lt; 3 &gt;( uext );
<a name="l01386"></a>01386 
<a name="l01387"></a>01387   <span class="comment">// Query bin sizes and extents of sample space from PDF</span>
<a name="l01388"></a>01388   binsize = <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.binsize();
<a name="l01389"></a>01389   ext = <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.extents();
<a name="l01390"></a>01390 
<a name="l01391"></a>01391   <span class="comment">// Compute number of bins in sample space directions (min bins: 1)</span>
<a name="l01392"></a>01392   <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( ext[1] &gt;= ext[0], <span class="stringliteral">&quot;Wrong extents in PDFWriter::extents&quot;</span> );
<a name="l01393"></a>01393   <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( ext[3] &gt;= ext[2], <span class="stringliteral">&quot;Wrong extents in PDFWriter::extents&quot;</span> );
<a name="l01394"></a>01394   <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( ext[5] &gt;= ext[4], <span class="stringliteral">&quot;Wrong extents in PDFWriter::extents&quot;</span> );
<a name="l01395"></a>01395   nbix = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>( ext[1] - ext[0] + 1 );
<a name="l01396"></a>01396   nbiy = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>( ext[3] - ext[2] + 1 );
<a name="l01397"></a>01397   nbiz = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>( ext[5] - ext[4] + 1 );
<a name="l01398"></a>01398 
<a name="l01399"></a>01399   <span class="comment">// Compute minima and maxima of sample space</span>
<a name="l01400"></a>01400   xmin = binsize[0] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[0] );
<a name="l01401"></a>01401   xmax = binsize[0] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[1] );
<a name="l01402"></a>01402   ymin = binsize[1] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[2] );
<a name="l01403"></a>01403   ymax = binsize[1] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[3] );
<a name="l01404"></a>01404   zmin = binsize[2] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[4] );
<a name="l01405"></a>01405   zmax = binsize[2] * <span class="keyword">static_cast&lt;</span> tk::real <span class="keyword">&gt;</span>( ext[5] );
<a name="l01406"></a>01406 
<a name="l01407"></a>01407   <span class="comment">// Override number of bins and minima if user-specified extents were given,</span>
<a name="l01408"></a>01408   <span class="comment">// and copy probabilities from pdf to a logically 3D array for output</span>
<a name="l01409"></a>01409   <span class="keywordflow">if</span> (!uext.empty()) {
<a name="l01410"></a>01410     <span class="comment">// Override number of bins by that based on user-specified extents</span>
<a name="l01411"></a>01411     <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( uext[1] &gt;= uext[0],
<a name="l01412"></a>01412             <span class="stringliteral">&quot;Wrong user-defined extents in PDFWriter::extents&quot;</span> );
<a name="l01413"></a>01413     <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( uext[3] &gt;= uext[2],
<a name="l01414"></a>01414             <span class="stringliteral">&quot;Wrong user-defined extents in PDFWriter::extents&quot;</span> );
<a name="l01415"></a>01415     <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( uext[5] &gt;= uext[4],
<a name="l01416"></a>01416             <span class="stringliteral">&quot;Wrong user-defined extents in PDFWriter::extents&quot;</span> );
<a name="l01417"></a>01417     nbix = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>(
<a name="l01418"></a>01418              std::lround( (uext[1] - uext[0]) / binsize[0] ) );
<a name="l01419"></a>01419     nbiy = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>(
<a name="l01420"></a>01420              std::lround( (uext[3] - uext[2]) / binsize[1] ) );
<a name="l01421"></a>01421     nbiz = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>(
<a name="l01422"></a>01422              std::lround( (uext[5] - uext[4]) / binsize[2] ) );
<a name="l01423"></a>01423     <span class="comment">// Override extents</span>
<a name="l01424"></a>01424     xmin = uext[0];
<a name="l01425"></a>01425     xmax = uext[1];
<a name="l01426"></a>01426     ymin = uext[2];
<a name="l01427"></a>01427     ymax = uext[3];
<a name="l01428"></a>01428     zmin = uext[4];
<a name="l01429"></a>01429     zmax = uext[5];
<a name="l01430"></a>01430 
<a name="l01431"></a>01431     <span class="comment">// Temporarily increase number of bins if node-centered output required</span>
<a name="l01432"></a>01432     <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) { ++nbix; ++nbiy; ++nbiz; }
<a name="l01433"></a>01433 
<a name="l01434"></a>01434     <span class="comment">// Size output pdf to user-requested dimensions to overridden nbiz * nbiy *</span>
<a name="l01435"></a>01435     <span class="comment">// nbix and initialize output probabilities to zero</span>
<a name="l01436"></a>01436     outpdf = std::vector&lt; tk::real &gt;( nbiz * nbiy * nbix, 0.0 );
<a name="l01437"></a>01437 
<a name="l01438"></a>01438     <span class="comment">// Fill requested region of pdf to be output from computed pdf</span>
<a name="l01439"></a>01439     <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; p : <a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.map()) {
<a name="l01440"></a>01440       <span class="comment">// Compute (i.e., shift) bin indices relative to user-requested extents</span>
<a name="l01441"></a>01441       <span class="keyword">const</span> <span class="keyword">auto</span> x = p.first[0] - std::lround( uext[0] / binsize[0] );
<a name="l01442"></a>01442       <span class="keyword">const</span> <span class="keyword">auto</span> y = p.first[1] - std::lround( uext[2] / binsize[1] );
<a name="l01443"></a>01443       <span class="keyword">const</span> <span class="keyword">auto</span> z = p.first[2] - std::lround( uext[4] / binsize[2] );
<a name="l01444"></a>01444       <span class="comment">// Only copy probability value if shifted bin indices fall within</span>
<a name="l01445"></a>01445       <span class="comment">// user-requested extents (lower inclusive, upper exclusive)</span>
<a name="l01446"></a>01446       <span class="keywordflow">if</span> (x &gt;= 0 &amp;&amp; x &lt; std::lround( (uext[1] - uext[0]) / binsize[0] ) &amp;&amp;
<a name="l01447"></a>01447           y &gt;= 0 &amp;&amp; y &lt; std::lround( (uext[3] - uext[2]) / binsize[1] ) &amp;&amp;
<a name="l01448"></a>01448           z &gt;= 0 &amp;&amp; z &lt; std::lround( (uext[5] - uext[4]) / binsize[2] ))
<a name="l01449"></a>01449       {
<a name="l01450"></a>01450         <span class="keyword">const</span> <span class="keyword">auto</span> X = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>( x );
<a name="l01451"></a>01451         <span class="keyword">const</span> <span class="keyword">auto</span> Y = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>( y );
<a name="l01452"></a>01452         <span class="keyword">const</span> <span class="keyword">auto</span> Z = <span class="keyword">static_cast&lt;</span> std::size_t <span class="keyword">&gt;</span>( z );
<a name="l01453"></a>01453         <span class="keyword">const</span> <span class="keyword">auto</span> bin = nbix*(Z*nbiy + Y) + X;
<a name="l01454"></a>01454         <a class="code" href="_exception_8h.html#a6e509ba096551a0924ec024afadba810" title="Assert macro that only throws an exception if expr fails.">Assert</a>( bin &lt; nbix*nbiy*nbiz, <span class="stringliteral">&quot;Bin overflow in &quot;</span>
<a name="l01455"></a>01455               <span class="stringliteral">&quot;user-specified-extent-based bin calculation of bivariate PDF.&quot;</span> );
<a name="l01456"></a>01456         <span class="comment">// Copy normalized probability to output pdf</span>
<a name="l01457"></a>01457         outpdf[ bin ] =
<a name="l01458"></a>01458           p.second / binsize[0] / binsize[1] / binsize[2]
<a name="l01459"></a>01459                    / <span class="keyword">static_cast&lt;</span>tk::real<span class="keyword">&gt;</span>(<a class="code" href="namespacetk_1_1ctr.html#a1ae4f5b7ac9b69c29ce96ee87042e499" title="Function for writing PDF sample space variables to output streams.">pdf</a>.nsample());
<a name="l01460"></a>01460       }
<a name="l01461"></a>01461     }
<a name="l01462"></a>01462 
<a name="l01463"></a>01463     <span class="comment">// Revert number of bins if node-centered output required</span>
<a name="l01464"></a>01464     <span class="keywordflow">if</span> (centering == <a class="code" href="namespacetk_1_1ctr.html#a40a0ecd250d0cb2a6fe75ffe159ffc15aa15bb289c418f4d0308eb5d9faec4eb2">ctr::PDFCenteringType::NODE</a>) { --nbix; --nbiy; --nbiz; }
<a name="l01465"></a>01465   }
<a name="l01466"></a>01466 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="_p_d_f_writer_8_c.html">PDFWriter.C</a>      </li>

    <li class="footer">Generated on Tue Jul 7 2015 03:25:00 for Quinoa by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
